import{a as X}from"./chunk-X5ZPGGCT.js";import{a as Z}from"./chunk-YHPIB4V5.js";import{a as Y}from"./chunk-AZ5JV5M2.js";import{f as j,i as z}from"./chunk-UUC3DEYY.js";import{b as H,c as R,f as G,h as U,m as J,n as K}from"./chunk-LKIX2EBI.js";import"./chunk-XHNAPF2T.js";import"./chunk-FQB7FWF7.js";import{$a as _,$b as B,Ca as o,Cb as N,Da as S,Db as P,Sa as b,Ua as c,Va as k,Wa as w,Za as n,_a as i,_b as L,ac as V,bc as Q,ca as T,cb as O,db as p,dc as q,eb as u,ka as v,la as C,mb as s,nb as M,ob as g,pb as I,rb as f,sb as h,tb as y,vb as A,wb as D,xb as E,yb as F,zb as W}from"./chunk-DEIGHZUX.js";import"./chunk-SZXJF6TW.js";import{i as x}from"./chunk-P2VZOJAX.js";var te=()=>["all","active","complete","cancelled"],ne=(r,m,e)=>({"bi-check-circle":r,"bi-x-circle":m,"bi-clock":e}),$=r=>["/orders",r],ie=(r,m)=>({"bi-exclamation-circle":r,"bi-clock":m});function re(r,m){if(r&1&&_(0,"i",59),r&2){let e=u().$implicit;c("ngClass",W(1,ne,e==="complete",e==="cancelled",e==="active"))}}function oe(r,m){if(r&1){let e=O();n(0,"button",57),p("click",function(){let t=v(e).$implicit,d=u();return C(d.statusFilter=t)}),b(1,re,1,5,"i",58),s(2),N(3,"titlecase"),i()}if(r&2){let e=m.$implicit,a=u();w("btn-primary",a.statusFilter===e)("btn-outline-secondary",a.statusFilter!==e),o(),c("ngIf",e!=="all"),o(),g(" ",P(3,6,e)," ")}}function ae(r,m){if(r&1){let e=O();n(0,"button",57),p("click",function(){v(e);let t=u();return C(t.hideCompleted=!t.hideCompleted)}),_(1,"i",60),s(2),i()}if(r&2){let e=u();w("btn-primary",e.hideCompleted)("btn-outline-secondary",!e.hideCompleted),o(),c("ngClass",e.hideCompleted?"bi-eye-slash":"bi-eye"),o(),g(" ",e.hideCompleted?"Hidden":"Completed"," ")}}function le(r,m){if(r&1){let e=O();n(0,"div",61)(1,"input",62),p("change",function(){let t=v(e).$implicit,d=u();return C(d.toggleAssembly(t))}),i(),n(2,"label",63),s(3),i()()}if(r&2){let e=m.$implicit,a=u();o(),c("id","assembly-"+e)("checked",a.selectedAssemblies.has(e)),o(),c("for","assembly-"+e),o(),g(" ",e," ")}}function se(r,m){r&1&&(n(0,"div",64)(1,"div",65),s(2,"Loading orders..."),i()())}function de(r,m){if(r&1){let e=O();n(0,"div",69)(1,"a",70),s(2,"Import Order"),i(),n(3,"button",4),p("click",function(){v(e);let t=u(2);return C(t.showNewOrderModal=!0)}),s(4,"Create Manually"),i()()}}function ce(r,m){if(r&1&&(n(0,"div",64)(1,"div",66)(2,"p",67),s(3),i(),b(4,de,5,0,"div",68),i()()),r&2){let e=u();o(3),g(" ",e.searchQuery||e.statusFilter!=="all"?"No orders match your filters":"No orders yet. Import or create one to get started."," "),o(),c("ngIf",!e.searchQuery&&e.statusFilter==="all")}}function me(r,m){if(r&1&&(n(0,"span",78),_(1,"i",59),s(2),i()),r&2){let e=u().$implicit,a=u(2);c("ngClass",a.utils.getDueDateBadgeClass(a.utils.getDueDateStatus(e.due_date).status)),o(),c("ngClass",F(3,ie,a.utils.getDueDateStatus(e.due_date).status==="overdue",a.utils.getDueDateStatus(e.due_date).status==="due-soon")),o(),g(" ",a.utils.getDueDateStatus(e.due_date).label," ")}}function ue(r,m){if(r&1&&(n(0,"span",87),s(1),i()),r&2){let e=u().$implicit;o(),M(e.tool_model)}}function pe(r,m){if(r&1&&(n(0,"span"),s(1),i()),r&2){let e=u().$implicit;o(),M(e.customer_name)}}function _e(r,m){if(r&1&&(n(0,"span"),s(1),i()),r&2){let e=u().$implicit;o(),g("PO: ",e.po_number,"")}}function ge(r,m){if(r&1&&(n(0,"span"),s(1),i()),r&2){let e=u().$implicit,a=u(2);w("text-danger",e.status==="active"&&a.utils.getDueDateStatus(e.due_date).status==="overdue"),o(),g(" Due: ",a.utils.formatDate(e.due_date)," ")}}function be(r,m){if(r&1){let e=O();n(0,"div",73)(1,"div",11)(2,"div",74)(3,"div",75)(4,"div",76)(5,"a",77),s(6),i(),n(7,"span",78),s(8),i(),b(9,me,3,6,"span",79),i(),n(10,"div",80),b(11,ue,2,1,"span",81)(12,pe,2,1,"span",82)(13,_e,2,1,"span",82)(14,ge,2,3,"span",83),n(15,"span"),s(16),i()()(),n(17,"div",84)(18,"div",85)(19,"div",86)(20,"span",87),s(21),i(),n(22,"span",67),s(23),i()(),n(24,"div",88),_(25,"div",89),i()(),n(26,"div",3)(27,"a",90),s(28),i(),n(29,"button",91),p("click",function(){let t=v(e).$implicit,d=u(2);return C(d.handleDeleteOrder(t))}),_(30,"i",92),i()()()()()()}if(r&2){let e=m.$implicit,a=u(2);k("border-left-width","4px"),w("border-start",!0)("border-success",e.status==="complete")("border-secondary",e.status==="cancelled")("border-danger",e.status==="active"&&a.utils.getDueDateStatus(e.due_date).status==="overdue")("border-warning",e.status==="active"&&a.utils.getDueDateStatus(e.due_date).status==="due-soon")("opacity-75",e.status==="complete")("opacity-50",e.status==="cancelled"),o(5),c("routerLink",E(37,$,e.id)),o(),g(" SO-",e.so_number," "),o(),c("ngClass",a.utils.getStatusBadgeClass(e.status)),o(),M(e.status),o(),c("ngIf",e.status==="active"&&a.utils.getDueDateStatus(e.due_date).status!=="no-date"),o(2),c("ngIf",e.tool_model),o(),c("ngIf",e.customer_name),o(),c("ngIf",e.po_number),o(),c("ngIf",e.due_date),o(2),g("",e.tools.length," tool(s)"),o(5),g("",e.progress_percent,"%"),o(2),I("",e.picked_items,"/",e.total_items," parts"),o(2),k("width",e.progress_percent,"%"),o(2),w("btn-outline-secondary",e.status==="complete"||e.status==="cancelled")("btn-primary",e.status==="active"),c("routerLink",E(39,$,e.id)),o(),g(" ",e.status==="active"?"Pick":"View"," ")}}function fe(r,m){if(r&1&&(n(0,"div",71),b(1,be,31,41,"div",72),i()),r&2){let e=u();o(),c("ngForOf",e.filteredOrders)}}function he(r,m){r&1&&_(0,"div",93)}var Te=(()=>{class r{constructor(e,a,t){this.ordersService=e,this.excelService=a,this.utils=t,this.orders=[],this.loading=!0,this.searchQuery="",this.statusFilter="active",this.hideCompleted=!1,this.sortBy="due-date",this.selectedAssemblies=new Set,this.showNewOrderModal=!1,this.newOrder={so_number:"",po_number:"",customer_name:"",tool_model:"",quantity:1,order_date:"",due_date:"",notes:""},this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.ordersService.orders$.subscribe(e=>{this.orders=e}),this.ordersService.loading$.subscribe(e=>{this.loading=e}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}get filteredOrders(){return[...this.orders.filter(a=>{let t=a.so_number.toLowerCase().includes(this.searchQuery.toLowerCase())||a.po_number?.toLowerCase().includes(this.searchQuery.toLowerCase())||a.customer_name?.toLowerCase().includes(this.searchQuery.toLowerCase()),d=this.statusFilter==="all"||a.status===this.statusFilter,l=!this.hideCompleted||a.status!=="complete",ee=this.selectedAssemblies.size===0||!!a.tool_model&&this.selectedAssemblies.has(a.tool_model);return t&&d&&l&&ee})].sort((a,t)=>{switch(this.sortBy){case"due-date":return!a.due_date&&!t.due_date?0:a.due_date?t.due_date?new Date(a.due_date).getTime()-new Date(t.due_date).getTime():-1:1;case"so-number":return a.so_number.localeCompare(t.so_number,void 0,{numeric:!0});case"created":default:return new Date(t.created_at).getTime()-new Date(a.created_at).getTime()}})}get uniqueAssemblies(){let e=new Set;return this.orders.forEach(a=>{a.tool_model&&e.add(a.tool_model)}),Array.from(e).sort((a,t)=>a.localeCompare(t,void 0,{numeric:!0}))}toggleAssembly(e){this.selectedAssemblies.has(e)?this.selectedAssemblies.delete(e):this.selectedAssemblies.add(e),this.selectedAssemblies=new Set(this.selectedAssemblies)}selectAllAssemblies(){this.selectedAssemblies=new Set(this.uniqueAssemblies)}deselectAllAssemblies(){this.selectedAssemblies=new Set}cycleSortBy(){let e=["due-date","created","so-number"],a=e.indexOf(this.sortBy);this.sortBy=e[(a+1)%e.length]}handleCreateOrder(){return x(this,null,function*(){this.newOrder.so_number.trim()&&(yield this.ordersService.createOrder({so_number:this.newOrder.so_number.trim(),po_number:this.newOrder.po_number.trim()||null,customer_name:this.newOrder.customer_name.trim()||null,tool_model:this.newOrder.tool_model.trim()||null,quantity:this.newOrder.quantity||1,order_date:this.newOrder.order_date||null,due_date:this.newOrder.due_date||null,notes:this.newOrder.notes.trim()||null}),this.resetNewOrder(),this.showNewOrderModal=!1)})}handleDeleteOrder(e){return x(this,null,function*(){confirm(`Delete order SO-${e.so_number}? This cannot be undone.`)&&(yield this.ordersService.deleteOrder(e.id))})}handleExportOrders(){return x(this,null,function*(){yield this.excelService.exportOrdersSummaryToExcel(this.orders)})}closeModalOnBackdrop(e){e.target.classList.contains("modal")&&(this.showNewOrderModal=!1)}resetNewOrder(){this.newOrder={so_number:"",po_number:"",customer_name:"",tool_model:"",quantity:1,order_date:"",due_date:"",notes:""}}static{this.\u0275fac=function(a){return new(a||r)(S(X),S(Z),S(Y))}}static{this.\u0275cmp=T({type:r,selectors:[["app-orders"]],standalone:!0,features:[A],decls:95,vars:24,consts:[[1,"page-header","d-flex","flex-wrap","justify-content-between","align-items-center","gap-3"],[1,"page-title"],[1,"page-subtitle"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-download","me-1"],["routerLink","/import",1,"btn","btn-outline-secondary"],[1,"bi","bi-upload","me-1"],[1,"btn","btn-primary",3,"click"],[1,"bi","bi-plus","me-1"],[1,"card","filter-bar"],[1,"card-body"],[1,"row","g-3","align-items-center"],[1,"col-md-4"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Search by SO#, PO#, or customer...",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-8"],[1,"d-flex","flex-wrap","gap-2"],["class","btn btn-sm",3,"btn-primary","btn-outline-secondary","click",4,"ngFor","ngForOf"],[1,"vr","mx-2"],["class","btn btn-sm",3,"btn-primary","btn-outline-secondary","click",4,"ngIf"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"bi","bi-arrow-down-up","me-1"],[1,"dropdown",3,"click"],["type","button","data-bs-toggle","dropdown","data-bs-auto-close","outside",1,"btn","btn-sm","btn-outline-secondary","dropdown-toggle","d-flex","align-items-center","gap-1"],[1,"bi","bi-tools"],[1,"dropdown-menu","p-0",2,"min-width","220px"],[1,"d-flex","border-bottom","p-2","gap-2"],[1,"btn","btn-sm","btn-ghost","flex-fill",3,"click"],[1,"p-2",2,"max-height","250px","overflow-y","auto"],["class","form-check px-2 py-1",4,"ngFor","ngForOf"],["class","card",4,"ngIf"],["class","d-flex flex-column gap-3",4,"ngIf"],["tabindex","-1",1,"modal","fade",3,"click"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label"],["type","text","placeholder","e.g., 3137",1,"form-control",3,"ngModelChange","ngModel"],["type","text","placeholder","Customer PO",1,"form-control",3,"ngModelChange","ngModel"],["type","text","placeholder","Customer name",1,"form-control",3,"ngModelChange","ngModel"],["type","text","placeholder","e.g., 230Q, NG1",1,"form-control",3,"ngModelChange","ngModel"],["type","number","min","1","placeholder","1",1,"form-control",3,"ngModelChange","ngModel"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12"],["type","text","placeholder","Any additional notes...",1,"form-control",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","modal-backdrop fade show",4,"ngIf"],[1,"btn","btn-sm",3,"click"],["class","bi me-1",3,"ngClass",4,"ngIf"],[1,"bi","me-1",3,"ngClass"],[1,"bi",3,"ngClass"],[1,"form-check","px-2","py-1"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label",3,"for"],[1,"card"],[1,"card-body","text-center","py-5","text-muted"],[1,"card-body","text-center","py-5"],[1,"text-muted"],["class","d-flex justify-content-center gap-2 mt-3",4,"ngIf"],[1,"d-flex","justify-content-center","gap-2","mt-3"],["routerLink","/import",1,"btn","btn-primary"],[1,"d-flex","flex-column","gap-3"],["class","card card-hover",3,"border-start","border-success","border-secondary","border-danger","border-warning","border-left-width","opacity-75","opacity-50",4,"ngFor","ngForOf"],[1,"card","card-hover"],[1,"d-flex","flex-wrap","justify-content-between","align-items-center","gap-3"],[1,"flex-grow-1"],[1,"d-flex","align-items-center","gap-2","flex-wrap","mb-1"],[1,"h5","mb-0","text-decoration-none",3,"routerLink"],[1,"badge",3,"ngClass"],["class","badge",3,"ngClass",4,"ngIf"],[1,"d-flex","flex-wrap","gap-3","small","text-muted"],["class","fw-medium",4,"ngIf"],[4,"ngIf"],[3,"text-danger",4,"ngIf"],[1,"d-flex","align-items-center","gap-3"],[2,"width","150px"],[1,"d-flex","justify-content-between","small","mb-1"],[1,"fw-medium"],[1,"progress",2,"height","8px"],[1,"progress-bar"],[1,"btn","btn-sm",3,"routerLink"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-trash"],[1,"modal-backdrop","fade","show"]],template:function(a,t){a&1&&(n(0,"div")(1,"div",0)(2,"div")(3,"h1",1),s(4,"Orders"),i(),n(5,"p",2),s(6,"Manage your sales orders and track picking progress"),i()(),n(7,"div",3)(8,"button",4),p("click",function(){return t.handleExportOrders()}),_(9,"i",5),s(10," Export "),i(),n(11,"a",6),_(12,"i",7),s(13," Import "),i(),n(14,"button",8),p("click",function(){return t.showNewOrderModal=!0}),_(15,"i",9),s(16," New Order "),i()()(),n(17,"div",10)(18,"div",11)(19,"div",12)(20,"div",13)(21,"div",14)(22,"span",15),_(23,"i",16),i(),n(24,"input",17),y("ngModelChange",function(l){return h(t.searchQuery,l)||(t.searchQuery=l),l}),i()()(),n(25,"div",18)(26,"div",19),b(27,oe,4,8,"button",20),_(28,"div",21),b(29,ae,3,6,"button",22),n(30,"button",23),p("click",function(){return t.cycleSortBy()}),_(31,"i",24),s(32),i(),n(33,"div",25),p("click",function(l){return l.stopPropagation()}),n(34,"button",26),_(35,"i",27),s(36),i(),n(37,"div",28)(38,"div",29)(39,"button",30),p("click",function(){return t.selectAllAssemblies()}),s(40,"Select All"),i(),n(41,"button",30),p("click",function(){return t.deselectAllAssemblies()}),s(42,"Clear"),i()(),n(43,"div",31),b(44,le,4,4,"div",32),i()()()()()()()(),b(45,se,3,0,"div",33)(46,ce,5,2,"div",33)(47,fe,2,1,"div",34),n(48,"div",35),p("click",function(l){return t.closeModalOnBackdrop(l)}),n(49,"div",36)(50,"div",37)(51,"div",38)(52,"h5",39),s(53,"Create New Order"),i(),n(54,"button",40),p("click",function(){return t.showNewOrderModal=!1}),i()(),n(55,"div",41)(56,"div",42)(57,"div",43)(58,"label",44),s(59,"SO Number *"),i(),n(60,"input",45),y("ngModelChange",function(l){return h(t.newOrder.so_number,l)||(t.newOrder.so_number=l),l}),i()(),n(61,"div",43)(62,"label",44),s(63,"PO Number"),i(),n(64,"input",46),y("ngModelChange",function(l){return h(t.newOrder.po_number,l)||(t.newOrder.po_number=l),l}),i()(),n(65,"div",43)(66,"label",44),s(67,"Customer"),i(),n(68,"input",47),y("ngModelChange",function(l){return h(t.newOrder.customer_name,l)||(t.newOrder.customer_name=l),l}),i()(),n(69,"div",43)(70,"label",44),s(71,"Tool Model"),i(),n(72,"input",48),y("ngModelChange",function(l){return h(t.newOrder.tool_model,l)||(t.newOrder.tool_model=l),l}),i()(),n(73,"div",43)(74,"label",44),s(75,"Quantity (# of Tools)"),i(),n(76,"input",49),y("ngModelChange",function(l){return h(t.newOrder.quantity,l)||(t.newOrder.quantity=l),l}),i()(),n(77,"div",43)(78,"label",44),s(79,"Order Date"),i(),n(80,"input",50),y("ngModelChange",function(l){return h(t.newOrder.order_date,l)||(t.newOrder.order_date=l),l}),i()(),n(81,"div",43)(82,"label",44),s(83,"Due Date"),i(),n(84,"input",50),y("ngModelChange",function(l){return h(t.newOrder.due_date,l)||(t.newOrder.due_date=l),l}),i()(),n(85,"div",51)(86,"label",44),s(87,"Notes"),i(),n(88,"input",52),y("ngModelChange",function(l){return h(t.newOrder.notes,l)||(t.newOrder.notes=l),l}),i()()()(),n(89,"div",53)(90,"button",54),p("click",function(){return t.showNewOrderModal=!1}),s(91,"Cancel"),i(),n(92,"button",55),p("click",function(){return t.handleCreateOrder()}),s(93," Create Order "),i()()()()(),b(94,he,1,0,"div",56),i()),a&2&&(o(24),f("ngModel",t.searchQuery),o(3),c("ngForOf",D(23,te)),o(2),c("ngIf",t.statusFilter==="all"),o(3),g(" ",t.sortBy==="due-date"?"Due Date":t.sortBy==="created"?"Created":"SO#"," "),o(4),g(" ",t.selectedAssemblies.size===0?"All Assemblies":t.selectedAssemblies.size+" Assembly"+(t.selectedAssemblies.size!==1?"s":"")," "),o(8),c("ngForOf",t.uniqueAssemblies),o(),c("ngIf",t.loading),o(),c("ngIf",!t.loading&&t.filteredOrders.length===0),o(),c("ngIf",!t.loading&&t.filteredOrders.length>0),o(),k("display",t.showNewOrderModal?"block":"none"),w("show",t.showNewOrderModal),o(12),f("ngModel",t.newOrder.so_number),o(4),f("ngModel",t.newOrder.po_number),o(4),f("ngModel",t.newOrder.customer_name),o(4),f("ngModel",t.newOrder.tool_model),o(4),f("ngModel",t.newOrder.quantity),o(4),f("ngModel",t.newOrder.order_date),o(4),f("ngModel",t.newOrder.due_date),o(4),f("ngModel",t.newOrder.notes),o(4),c("disabled",!t.newOrder.so_number.trim()),o(2),c("ngIf",t.showNewOrderModal))},dependencies:[q,L,B,V,Q,z,j,K,H,U,R,J,G],encapsulation:2})}}return r})();export{Te as OrdersComponent};
