import{T as h,g as u}from"./chunk-2TFJQIGG.js";import{a as c,b as a,e as l}from"./chunk-DVOCWXDE.js";var f="offline-picks-queue",g=(()=>{class s{get isOnline(){return this.onlineSubject.getValue()}get queueCount(){return this.queueSubject.getValue().length}get queue(){return this.queueSubject.getValue()}constructor(){this.onlineSubject=new u(typeof navigator<"u"?navigator.onLine:!0),this.queueSubject=new u([]),this.syncingSubject=new u(!1),this.onlineListener=null,this.offlineListener=null,this.isOnline$=this.onlineSubject.asObservable(),this.queue$=this.queueSubject.asObservable(),this.isSyncing$=this.syncingSubject.asObservable(),this.loadQueueFromStorage(),this.setupOnlineStatusListeners()}ngOnDestroy(){this.onlineListener&&window.removeEventListener("online",this.onlineListener),this.offlineListener&&window.removeEventListener("offline",this.offlineListener)}setupOnlineStatusListeners(){this.onlineListener=()=>{this.onlineSubject.next(!0),this.emitSyncReadyEvent()},this.offlineListener=()=>this.onlineSubject.next(!1),window.addEventListener("online",this.onlineListener),window.addEventListener("offline",this.offlineListener)}loadQueueFromStorage(){try{let e=localStorage.getItem(f);e&&this.queueSubject.next(JSON.parse(e))}catch(e){console.error("Failed to load offline queue:",e)}}saveQueueToStorage(){try{localStorage.setItem(f,JSON.stringify(this.queueSubject.getValue()))}catch(e){console.error("Failed to save offline queue:",e)}}emitSyncReadyEvent(){let e=this.queueCount;e>0&&!this.syncingSubject.getValue()&&window.dispatchEvent(new CustomEvent("offline-queue-ready-to-sync",{detail:{count:e}}))}addToQueue(e){let t=a(c({},e),{id:crypto.randomUUID(),timestamp:new Date().toISOString()}),n=this.queueSubject.getValue();return this.queueSubject.next([...n,t]),this.saveQueueToStorage(),t}removeFromQueue(e){let t=this.queueSubject.getValue();this.queueSubject.next(t.filter(n=>n.id!==e)),this.saveQueueToStorage()}clearQueue(){this.queueSubject.next([]),this.saveQueueToStorage()}setSyncing(e){this.syncingSubject.next(e)}syncQueue(e){return l(this,null,function*(){let t=this.queueSubject.getValue();if(t.length===0)return{success:0,failed:0};this.syncingSubject.next(!0);let n=0,o=0;for(let i of t)try{(yield e(i.lineItemId,i.toolId,i.qtyPicked,i.pickedBy,i.notes))?(this.removeFromQueue(i.id),n++):o++}catch(r){console.error("Failed to sync pick:",r),o++}return this.syncingSubject.next(!1),{success:n,failed:o}})}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=h({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{g as a};
