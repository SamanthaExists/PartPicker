import{a as M}from"./chunk-522F5RD2.js";import{a as ae,b as le,c as re,d as R}from"./chunk-PWUCMIIP.js";import{a as k,b as oe}from"./chunk-5MGDKTZD.js";import{a as ne}from"./chunk-ZEZXQGFQ.js";import{b as L,c as j,f as W,i as Z,j as ee,k as te,n as $}from"./chunk-LKIX2EBI.js";import"./chunk-XHNAPF2T.js";import"./chunk-FQB7FWF7.js";import{$a as p,$b as V,Bb as X,Ca as r,Da as w,Sa as _,T as H,Ta as K,Ua as m,Wa as x,Y as P,Ya as S,Za as n,_a as l,_b as O,ac as N,ca as F,cb as y,db as u,dc as B,eb as c,ic as ie,ka as g,la as b,mb as o,n as U,nb as f,o as Y,ob as v,rb as I,sa as J,sb as T,tb as E,vb as A}from"./chunk-DEIGHZUX.js";import"./chunk-SZXJF6TW.js";import{i as C}from"./chunk-P2VZOJAX.js";var Q=(()=>{class i{constructor(e,a,t,d){this.bomTemplates=e,this.parts=a,this.relationships=t,this.supabase=d}listAllItems(){return Y([this.bomTemplates.templates$,this.parts.parts$]).pipe(U(([e,a])=>[...this.mapTemplates(e),...this.mapParts(a)]))}filterTemplates(){return this.bomTemplates.templates$.pipe(U(e=>this.mapTemplates(e)))}filterAssemblies(){return this.parts.parts$.pipe(U(e=>this.mapParts(e.filter(a=>a.is_assembly===!0))))}filterParts(){return this.parts.parts$.pipe(U(e=>this.mapParts(e.filter(a=>a.is_assembly!==!0))))}getItem(e,a){return C(this,null,function*(){if(a==="template"){let t=yield this.bomTemplates.getTemplateWithItems(e);if(!t)throw new Error(`Template not found: ${e}`);return{type:"template",data:t}}else{let t=yield this.parts.getPartWithRelationships(e);if(!t)throw new Error(`Part not found: ${e}`);return{type:"part",data:t}}})}convertTemplateToAssembly(e){return C(this,null,function*(){let a=yield this.bomTemplates.getTemplateWithItems(e);if(!a||!a.items||a.items.length===0)throw new Error("Cannot convert empty template to assembly");let t=`ASSY-${a.tool_model||a.name.replace(/\s+/g,"-")}`,d=yield this.parts.createPart({part_number:t,description:a.name,classification_type:null,is_assembly:!0,is_modified:!1,default_location:null,base_part_id:null,notes:`Converted from template: ${a.name}`});for(let h of a.items){let D=yield this.parts.findOrCreatePart(h.part_number,h.description,h.location,null);yield this.relationships.createRelationship(d.id,D.id,h.qty_per_unit,{notes:h.assembly_group?`Assembly Group: ${h.assembly_group}`:void 0,sortOrder:0})}return yield this.updateTemplateLinkToPart(e,d.id),d})}savePartAsTemplate(e,a){return C(this,null,function*(){let t=yield this.parts.getPartWithRelationships(e);if(!t||!t.children||t.children.length===0)throw new Error("Cannot create template from part with no children");let d=a?.name||t.description||t.part_number,h=a?.toolModel||void 0,D=yield this.bomTemplates.createTemplate(d,h,"assembly");if(!D)throw new Error("Failed to create template");for(let z of t.children){let q=z.part,_e=z.notes?.match(/Assembly Group: (.+)/)?.[1]||null;yield this.bomTemplates.addTemplateItem(D.id,{part_number:q.part_number,description:q.description,location:q.default_location,qty_per_unit:z.quantity,assembly_group:_e})}yield this.updateTemplateLinkToPart(D.id,e);let G=yield this.bomTemplates.getTemplateWithItems(D.id);if(!G)throw new Error("Failed to retrieve created template");return G})}updateTemplateLinkToPart(e,a){return C(this,null,function*(){let{error:t}=yield this.supabase.from("bom_templates").update({part_id:a}).eq("id",e);t&&console.error("Error linking template to part:",t)})}mapTemplates(e){return e.map(a=>({id:a.id,type:"template",displayName:a.name,subtitle:a.tool_model||"No tool model",badges:[{text:a.template_type==="assembly"?"Assembly":"BOM",color:a.template_type==="assembly"?"bg-info":"bg-primary",icon:a.template_type==="assembly"?"bi-boxes":"bi-list-ul"},...a.tool_model?[{text:a.tool_model,color:"bg-secondary",icon:"bi-tools"}]:[]],icon:"bi-file-earmark-text",stats:{itemCount:0}}))}mapParts(e){return e.map(a=>({id:a.id,type:"part",displayName:a.part_number,subtitle:a.description||"No description",badges:[this.getClassificationBadge(a.classification_type),...a.child_count>0?[{text:`${a.child_count} parts`,color:"bg-secondary",icon:"bi-diagram-3"}]:[],...a.used_in_count>0?[{text:`Used in ${a.used_in_count}`,color:"bg-light text-dark",icon:"bi-arrow-up"}]:[]],icon:this.getClassificationIcon(a.classification_type),stats:{childCount:a.child_count,usedInCount:a.used_in_count}}))}getClassificationBadge(e){switch(e){case"manufactured":return{text:"Manufactured",color:"bg-warning text-dark",icon:"bi-gear"};case"purchased":return{text:"Purchased",color:"bg-success",icon:"bi-cart"};default:return{text:"Unclassified",color:"bg-secondary"}}}getClassificationIcon(e){switch(e){case"manufactured":return"bi-gear";case"purchased":return"bi-cart";default:return"bi-circle"}}static{this.\u0275fac=function(a){return new(a||i)(P(M),P(k),P(oe),P(ie))}}static{this.\u0275prov=H({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function be(i,s){if(i&1&&p(0,"i"),i&2){let e=c();S("bi ",e.item.type==="template"?"bi-file-earmark-text":"bi-box-seam"," text-primary")}}function ve(i,s){if(i&1&&(n(0,"span"),o(1),l()),i&2){let e=c();r(),f(e.templateData.name)}}function he(i,s){if(i&1&&(n(0,"span"),o(1),l()),i&2){let e=c();r(),f(e.partData.part_number)}}function xe(i,s){if(i&1&&(n(0,"span"),o(1),l()),i&2){let e=c();r(),v("",e.templateData.items.length," items")}}function ye(i,s){if(i&1&&(n(0,"span"),o(1),l()),i&2){let e=c();r(),f(e.partData.description)}}function Ce(i,s){i&1&&(n(0,"div",15)(1,"div",16)(2,"span",17),o(3,"Loading..."),l()(),n(4,"p",18),o(5,"Loading..."),l()())}function we(i,s){if(i&1&&(n(0,"div",19),p(1,"i",20),o(2),l()),i&2){let e=c();r(2),v("",e.error," ")}}function Se(i,s){if(i&1&&(n(0,"span",31),p(1,"i",32),o(2),l()),i&2){let e=c(2);r(2),v("",e.templateData.tool_model," ")}}function Ie(i,s){if(i&1){let e=y();n(0,"div",35),u("click",function(){let t=g(e).$implicit,d=c(3);return b(d.selectAssembly(t.key))}),n(1,"div",2),p(2,"i",40),n(3,"span",41),o(4),l(),n(5,"span",42),o(6),l()()()}if(i&2){let e=s.$implicit,a=c(3);x("active",a.selectedAssemblyFilter===e.key),r(2),m("ngClass",e.key==="__unassigned__"?"bi-puzzle":"bi-box-seam"),r(2),f(e.name),r(),x("bg-secondary",e.key==="__unassigned__")("bg-primary",e.key!=="__unassigned__"),r(),f(e.count)}}function Te(i,s){if(i&1){let e=y();n(0,"div",33)(1,"div",34)(2,"div",35),u("click",function(){g(e);let t=c(2);return b(t.selectAssembly(null))}),n(3,"div",2),p(4,"i",36),n(5,"span",37),o(6,"All Items"),l(),n(7,"span",38),o(8),l()()(),_(9,Ie,7,9,"div",39),l()()}if(i&2){let e=c(2);r(2),x("active",e.selectedAssemblyFilter===null),r(6),f(e.templateData.items.length),r(),m("ngForOf",e.assemblyGroups)}}function Ee(i,s){if(i&1){let e=y();n(0,"button",48),u("click",function(){g(e);let t=c(3);return b(t.templateItemSearch="")}),p(1,"i",49),l()}}function De(i,s){if(i&1){let e=y();n(0,"div",21)(1,"div",43)(2,"span",44),p(3,"i",45),l(),n(4,"input",46),E("ngModelChange",function(t){g(e);let d=c(2);return T(d.templateItemSearch,t)||(d.templateItemSearch=t),b(t)}),l(),_(5,Ee,2,0,"button",47),l()()}if(i&2){let e=c(2);r(4),I("ngModel",e.templateItemSearch),r(),m("ngIf",e.templateItemSearch)}}function ke(i,s){i&1&&(n(0,"th"),o(1,"Assembly"),l())}function Me(i,s){if(i&1&&(n(0,"span",53),o(1),l()),i&2){let e=c(2).$implicit;r(),f(e.assembly_group)}}function Ue(i,s){i&1&&(n(0,"span",54),o(1,"Loose"),l())}function Pe(i,s){if(i&1&&(n(0,"td"),_(1,Me,2,1,"span",51)(2,Ue,2,0,"span",52),l()),i&2){let e=c().$implicit;r(),m("ngIf",e.assembly_group),r(),m("ngIf",!e.assembly_group)}}function Fe(i,s){if(i&1&&(n(0,"tr")(1,"td",50),o(2),l(),n(3,"td"),o(4),l(),n(5,"td"),o(6),l(),n(7,"td",29),o(8),l(),_(9,Pe,3,2,"td",5),l()),i&2){let e=s.$implicit,a=c(2);r(2),f(e.part_number),r(2),f(e.description||"-"),r(2),f(e.location||"-"),r(2),f(e.qty_per_unit),r(),m("ngIf",a.hasMultipleAssemblies)}}function Ae(i,s){if(i&1&&(n(0,"tr")(1,"td",55),p(2,"i",56),o(3,"No items match your filter "),l()()),i&2){let e=c(2);r(),K("colspan",e.hasMultipleAssemblies?5:4)}}function Oe(i,s){if(i&1&&(n(0,"div")(1,"div",21)(2,"div",22),_(3,Se,3,1,"span",23),n(4,"span",24),p(5,"i"),o(6),l()()(),_(7,Te,10,4,"div",25)(8,De,6,2,"div",26),n(9,"div",27)(10,"table",28)(11,"thead")(12,"tr")(13,"th"),o(14,"Part Number"),l(),n(15,"th"),o(16,"Description"),l(),n(17,"th"),o(18,"Location"),l(),n(19,"th",29),o(20,"Qty"),l(),_(21,ke,2,0,"th",5),l()(),n(22,"tbody"),_(23,Fe,10,5,"tr",30)(24,Ae,4,1,"tr",5),l()()()()),i&2){let e=c();r(3),m("ngIf",e.templateData.tool_model),r(2),S("bi bi-",e.templateData.template_type==="assembly"?"boxes":"list-ul"," me-1"),r(),v(" ",e.templateData.template_type==="assembly"?"Assembly":"BOM"," "),r(),m("ngIf",e.hasMultipleAssemblies),r(),m("ngIf",e.templateData.items.length>0),r(13),m("ngIf",e.hasMultipleAssemblies),r(2),m("ngForOf",e.filteredTemplateItems),r(),m("ngIf",e.filteredTemplateItems.length===0)}}function Ve(i,s){if(i&1&&(n(0,"div",66)(1,"label",61),o(2,"Notes"),l(),n(3,"div",37),o(4),l()()),i&2){let e=c(2);r(4),f(e.partData.notes)}}function Ne(i,s){if(i&1&&(n(0,"tr")(1,"td",50),o(2),l(),n(3,"td"),o(4),l(),n(5,"td"),o(6),l(),n(7,"td"),o(8),l()()),i&2){let e=s.$implicit;r(2),f(e.part.part_number),r(2),f(e.part.description||"-"),r(2),f(e.quantity),r(2),f(e.reference_designator||"-")}}function Be(i,s){if(i&1&&(n(0,"div",21)(1,"h6",67),o(2),l(),n(3,"div",27)(4,"table",28)(5,"thead")(6,"tr")(7,"th"),o(8,"Part Number"),l(),n(9,"th"),o(10,"Description"),l(),n(11,"th"),o(12,"Qty"),l(),n(13,"th"),o(14,"Ref Des"),l()()(),n(15,"tbody"),_(16,Ne,9,4,"tr",30),l()()()()),i&2){let e=c(2);r(2),v("Bill of Materials (",e.partData.children.length," parts)"),r(14),m("ngForOf",e.partData.children)}}function Le(i,s){if(i&1&&(n(0,"span",73),o(1),l()),i&2){let e=c().$implicit;r(),f(e.part.description)}}function je(i,s){if(i&1&&(n(0,"div",70)(1,"div",71)(2,"div")(3,"span",50),o(4),l(),_(5,Le,2,1,"span",72),l(),n(6,"span",31),o(7),l()()()),i&2){let e=s.$implicit;r(4),f(e.part.part_number),r(),m("ngIf",e.part.description),r(2),v("Qty: ",e.quantity,"")}}function We(i,s){if(i&1&&(n(0,"div",21)(1,"h6",67),o(2),l(),n(3,"div",68),_(4,je,8,3,"div",69),l()()),i&2){let e=c(2);r(2),v("Used In (",e.partData.used_in.length," assemblies)"),r(2),m("ngForOf",e.partData.used_in)}}function $e(i,s){i&1&&(n(0,"div",74),p(1,"i",75),n(2,"p"),o(3,"This part has no BOM relationships yet"),l()())}function Qe(i,s){if(i&1&&(n(0,"div")(1,"div",57)(2,"div",58)(3,"div",59)(4,"div",60)(5,"label",61),o(6,"Part Number"),l(),n(7,"div",62),o(8),l()(),n(9,"div",60)(10,"label",61),o(11,"Classification"),l(),n(12,"div"),p(13,"app-classification-badge",63),l()(),n(14,"div",60)(15,"label",61),o(16,"Description"),l(),n(17,"div"),o(18),l()(),n(19,"div",60)(20,"label",61),o(21,"Location"),l(),n(22,"div"),o(23),l()(),_(24,Ve,5,1,"div",64),l()()(),_(25,Be,17,2,"div",26)(26,We,5,2,"div",26)(27,$e,4,0,"div",65),l()),i&2){let e=c();r(8),f(e.partData.part_number),r(5),m("classification",e.partData.classification_type),r(5),f(e.partData.description||"-"),r(5),f(e.partData.default_location||"-"),r(),m("ngIf",e.partData.notes),r(),m("ngIf",e.partData.children&&e.partData.children.length>0),r(),m("ngIf",e.partData.used_in&&e.partData.used_in.length>0),r(),m("ngIf",e.partData.children.length===0&&e.partData.used_in.length===0)}}function ze(i,s){if(i&1){let e=y();n(0,"button",76),u("click",function(){g(e);let t=c();return b(t.convertToAssembly())}),p(1,"i",77),o(2," Upgrade to Engineering BOM "),l()}}function qe(i,s){if(i&1){let e=y();n(0,"button",76),u("click",function(){g(e);let t=c();return b(t.saveAsTemplate())}),p(1,"i",78),o(2," Save as Template "),l()}}var pe=(()=>{class i{constructor(e,a,t,d,h){this.activeModal=e,this.bridge=a,this.bomTemplates=t,this.parts=d,this.toast=h,this.itemUpdated=new J,this.item=null,this.loading=!0,this.error=null,this.selectedAssemblyFilter=null,this.assemblyGroups=[],this.hasMultipleAssemblies=!1,this.templateItemSearch=""}ngOnInit(){this.loadItem()}loadItem(){return C(this,null,function*(){try{this.loading=!0,this.error=null,this.item=yield this.bridge.getItem(this.itemId,this.itemType),this.item.type==="template"&&this.initializeTemplateView(),this.loading=!1}catch(e){this.error=e instanceof Error?e.message:"Failed to load item",this.loading=!1}})}initializeTemplateView(){if(this.item?.type!=="template")return;let e=this.item.data,a=new Map;e.items.forEach(t=>{let d=t.assembly_group||"__unassigned__";a.set(d,(a.get(d)||0)+1)}),this.assemblyGroups=Array.from(a.entries()).map(([t,d])=>({name:t==="__unassigned__"?"Loose Parts":t,key:t,count:d})).sort((t,d)=>t.key==="__unassigned__"?1:d.key==="__unassigned__"?-1:t.name.localeCompare(d.name)),this.hasMultipleAssemblies=this.assemblyGroups.length>=2}get templateData(){return this.item?.type==="template"?this.item.data:null}get partData(){return this.item?.type==="part"?this.item.data:null}get filteredTemplateItems(){if(!this.templateData)return[];let e=this.templateData.items;if(this.selectedAssemblyFilter!==null&&(e=e.filter(a=>(a.assembly_group||"__unassigned__")===this.selectedAssemblyFilter)),this.templateItemSearch.trim()){let a=this.templateItemSearch.toLowerCase();e=e.filter(t=>t.part_number.toLowerCase().includes(a)||t.description&&t.description.toLowerCase().includes(a)||t.location&&t.location.toLowerCase().includes(a))}return e}selectAssembly(e){this.selectedAssemblyFilter=e}get activeFilterName(){if(!this.selectedAssemblyFilter)return"All Items";let e=this.assemblyGroups.find(a=>a.key===this.selectedAssemblyFilter);return e?e.name:"Unknown"}convertToAssembly(){return C(this,null,function*(){if(this.templateData&&confirm(`Convert "${this.templateData.name}" to an engineering BOM assembly part?

This will create a new assembly part with full BOM relationships.`))try{this.loading=!0;let e=yield this.bridge.convertTemplateToAssembly(this.templateData.id);this.toast.success(`Successfully created assembly part: ${e.part_number}`),this.itemUpdated.emit(),this.activeModal.close("converted")}catch(e){this.toast.error(e instanceof Error?e.message:"Failed to convert template"),this.loading=!1}})}saveAsTemplate(){return C(this,null,function*(){if(!this.partData)return;let e=prompt("Enter template name:",this.partData.description||this.partData.part_number);if(e)try{this.loading=!0;let a=yield this.bridge.savePartAsTemplate(this.partData.id,{name:e});this.toast.success(`Successfully created template: ${a.name}`),this.itemUpdated.emit(),this.activeModal.close("saved")}catch(a){this.toast.error(a instanceof Error?a.message:"Failed to save as template"),this.loading=!1}})}close(){this.activeModal.dismiss()}static{this.\u0275fac=function(a){return new(a||i)(w(le),w(Q),w(M),w(k),w(ne))}}static{this.\u0275cmp=F({type:i,selectors:[["app-unified-detail"]],inputs:{itemId:"itemId",itemType:"itemType"},outputs:{itemUpdated:"itemUpdated"},standalone:!0,features:[A],decls:23,vars:11,consts:[[1,"modal-header"],[1,"flex-grow-1"],[1,"d-flex","align-items-center","gap-2"],[3,"class",4,"ngIf"],[1,"modal-title","mb-0"],[4,"ngIf"],[1,"text-muted"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","text-center py-5",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"modal-footer"],[1,"d-flex","justify-content-between","w-100"],["class","btn btn-outline-primary btn-sm",3,"click",4,"ngIf"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"text-muted","mt-3"],[1,"alert","alert-danger"],[1,"bi","bi-exclamation-triangle","me-2"],[1,"mb-3"],[1,"d-flex","flex-wrap","gap-2","mb-2"],["class","badge bg-secondary",4,"ngIf"],[1,"badge","bg-info"],["class","assembly-group-cards mb-3",4,"ngIf"],["class","mb-3",4,"ngIf"],[1,"table-responsive"],[1,"table","table-sm","table-hover"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"badge","bg-secondary"],[1,"bi","bi-tools","me-1"],[1,"assembly-group-cards","mb-3"],[1,"d-flex","flex-wrap","gap-2"],["role","button",1,"assembly-card-mini",3,"click"],[1,"bi","bi-list-task"],[1,"small"],[1,"badge","bg-primary","ms-auto"],["class","assembly-card-mini","role","button",3,"active","click",4,"ngFor","ngForOf"],[1,"bi",3,"ngClass"],[1,"small","text-truncate",2,"max-width","120px"],[1,"badge","ms-auto"],[1,"input-group","input-group-sm"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Search items...",1,"form-control",3,"ngModelChange","ngModel"],["class","btn btn-outline-secondary",3,"click",4,"ngIf"],[1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-x-lg"],[1,"font-monospace"],["class","badge bg-light text-dark small",4,"ngIf"],["class","text-muted fst-italic small",4,"ngIf"],[1,"badge","bg-light","text-dark","small"],[1,"text-muted","fst-italic","small"],[1,"text-center","text-muted","py-3"],[1,"bi","bi-funnel","me-2"],[1,"card","mb-3"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label","small","text-muted"],[1,"fw-semibold","font-monospace"],[3,"classification"],["class","col-12",4,"ngIf"],["class","text-center text-muted py-4",4,"ngIf"],[1,"col-12"],[1,"mb-2"],[1,"list-group","list-group-sm"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex","justify-content-between","align-items-center"],["class","text-muted small ms-2",4,"ngIf"],[1,"text-muted","small","ms-2"],[1,"text-center","text-muted","py-4"],[1,"bi","bi-diagram-3","display-4","opacity-50","d-block","mb-2"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"bi","bi-arrow-right-circle","me-1"],[1,"bi","bi-save","me-1"]],template:function(a,t){a&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),_(3,be,1,3,"i",3),n(4,"h5",4),_(5,ve,2,1,"span",5)(6,he,2,1,"span",5),l()(),n(7,"small",6),_(8,xe,2,1,"span",5)(9,ye,2,1,"span",5),l()(),n(10,"button",7),u("click",function(){return t.close()}),l()(),n(11,"div",8),_(12,Ce,6,0,"div",9)(13,we,3,1,"div",10)(14,Oe,25,10,"div",5)(15,Qe,28,8,"div",5),l(),n(16,"div",11)(17,"div",12)(18,"div"),_(19,ze,3,0,"button",13)(20,qe,3,0,"button",13),l(),n(21,"button",14),u("click",function(){return t.close()}),o(22,"Close"),l()()()),a&2&&(r(3),m("ngIf",t.item),r(2),m("ngIf",t.templateData),r(),m("ngIf",t.partData),r(2),m("ngIf",t.templateData),r(),m("ngIf",t.partData),r(3),m("ngIf",t.loading),r(),m("ngIf",t.error&&!t.loading),r(),m("ngIf",!t.loading&&t.templateData),r(),m("ngIf",!t.loading&&t.partData),r(4),m("ngIf",t.templateData),r(),m("ngIf",t.partData&&t.partData.children.length>0))},dependencies:[B,O,V,N,$,L,j,W,ae],styles:[".assembly-card-mini[_ngcontent-%COMP%]{padding:.5rem .75rem;border:1px solid #dee2e6;border-radius:.375rem;background:#fff;transition:all .2s ease;cursor:pointer;min-width:140px}.assembly-card-mini[_ngcontent-%COMP%]:hover{background:#f8f9fa;border-color:#0d6efd}.assembly-card-mini.active[_ngcontent-%COMP%]{background:#e7f1ff;border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd1a}.assembly-group-cards[_ngcontent-%COMP%]{overflow-x:auto;-webkit-overflow-scrolling:touch}.assembly-group-cards[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}.assembly-group-cards[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.assembly-group-cards[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:4px}.table-sm[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table-sm[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem;vertical-align:middle}.list-group-sm[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]{padding:.5rem .75rem}"]})}}return i})();var Re=(i,s,e,a,t)=>({"icon-circle-blue":i,"icon-circle-purple":s,"icon-circle-green":e,"icon-circle-amber":a,"icon-circle-cyan":t});function Ge(i,s){if(i&1){let e=y();n(0,"div",36)(1,"div",37)(2,"strong"),p(3,"i",9),o(4,"New Template"),l(),n(5,"button",38),u("click",function(){g(e);let t=c();return b(t.cancelTemplateDialog())}),l()(),n(6,"div",18)(7,"div",19)(8,"div",39)(9,"label",40),o(10,"Template Name *"),l(),n(11,"input",41),E("ngModelChange",function(t){g(e);let d=c();return T(d.templateForm.name,t)||(d.templateForm.name=t),b(t)}),u("keydown.enter",function(){g(e);let t=c();return b(t.handleSaveTemplate())}),l()(),n(12,"div",26)(13,"label",40),o(14,"Tool Model"),l(),n(15,"input",42),E("ngModelChange",function(t){g(e);let d=c();return T(d.templateForm.tool_model,t)||(d.templateForm.tool_model=t),b(t)}),u("keydown.enter",function(){g(e);let t=c();return b(t.handleSaveTemplate())}),l()(),n(16,"div",43)(17,"label",40),o(18,"Type"),l(),n(19,"select",27),E("ngModelChange",function(t){g(e);let d=c();return T(d.templateForm.template_type,t)||(d.templateForm.template_type=t),b(t)}),n(20,"option",44),o(21,"BOM"),l(),n(22,"option",45),o(23,"Assembly"),l()()()(),n(24,"div",46)(25,"button",47),u("click",function(){g(e);let t=c();return b(t.cancelTemplateDialog())}),o(26,"Cancel"),l(),n(27,"button",48),u("click",function(){g(e);let t=c();return b(t.handleSaveTemplate())}),p(28,"i",49),o(29," Create Template "),l()()()()}if(i&2){let e=c();r(11),I("ngModel",e.templateForm.name),r(4),I("ngModel",e.templateForm.tool_model),r(4),I("ngModel",e.templateForm.template_type),r(8),m("disabled",!e.templateForm.name.trim())}}function Ye(i,s){if(i&1){let e=y();n(0,"button",47),u("click",function(){g(e);let t=c();return t.searchQuery="",b(t.applyFilters())}),p(1,"i",50),l()}}function He(i,s){i&1&&(n(0,"div",51)(1,"div",52)(2,"span",53),o(3,"Loading..."),l()(),n(4,"p",54),o(5,"Loading items..."),l()())}function Je(i,s){if(i&1){let e=y();n(0,"div",60)(1,"button",61),u("click",function(){g(e);let t=c(2);return b(t.showNewTemplateDialog())}),p(2,"i",62),o(3," New Template "),l(),n(4,"button",61),u("click",function(){g(e);let t=c(2);return b(t.showNewAssemblyDialog())}),p(5,"i",63),o(6," New Assembly "),l(),n(7,"button",61),u("click",function(){g(e);let t=c(2);return b(t.showNewPartDialog())}),p(8,"i",64),o(9," New Part "),l()()}}function Ke(i,s){if(i&1&&(n(0,"div",55)(1,"div",56),p(2,"i",57),n(3,"p",58),o(4),l(),_(5,Je,10,0,"div",59),l()()),i&2){let e=c();r(4),v(" ",e.searchQuery?"No items match your search":"No items yet. Create one to get started."," "),r(),m("ngIf",!e.searchQuery)}}function Xe(i,s){if(i&1&&p(0,"i"),i&2){let e=c().$implicit;S("bi ",e.icon," me-1")}}function Ze(i,s){if(i&1&&(n(0,"span"),_(1,Xe,1,3,"i",88),o(2),l()),i&2){let e=s.$implicit;S("badge ",e.color,""),r(),m("ngIf",e.icon),r(),v("",e.text," ")}}function et(i,s){if(i&1&&(n(0,"span",89),o(1),l()),i&2){let e=c().$implicit;r(),v(" ",e.stats.itemCount," items ")}}function tt(i,s){if(i&1&&(n(0,"span",89),o(1),l()),i&2){let e=c().$implicit;r(),v(" ",e.stats.childCount," parts ")}}function it(i,s){if(i&1&&(n(0,"span",32),o(1),l()),i&2){let e=c().$implicit;r(),v(" \u2022 ",e.stats.usedInCount," assy ")}}function nt(i,s){i&1&&(n(0,"span",90),o(1," \u2014 "),l())}function at(i,s){if(i&1&&p(0,"i"),i&2){let e=c().$implicit;S("bi ",e.icon," me-1")}}function lt(i,s){if(i&1&&(n(0,"span"),_(1,at,1,3,"i",88),o(2),l()),i&2){let e=s.$implicit;S("badge ",e.color," small"),r(),m("ngIf",e.icon),r(),v("",e.text," ")}}function rt(i,s){if(i&1){let e=y();n(0,"div",66)(1,"div",67),u("click",function(){let t=g(e).$implicit,d=c(2);return b(d.openItem(t))}),n(2,"div",68)(3,"div",69)(4,"div",70)(5,"div",71),p(6,"i"),l()(),n(7,"div",72)(8,"div",73),p(9,"i"),n(10,"div",74),o(11),l()(),n(12,"div",75),_(13,Ze,3,5,"span",76),l()(),n(14,"div",77)(15,"div",78),o(16),l()(),n(17,"div",79)(18,"div",80),o(19,"Stats"),l(),n(20,"div",81),_(21,et,2,1,"span",82)(22,tt,2,1,"span",82)(23,it,2,1,"span",83)(24,nt,2,0,"span",84),l()(),n(25,"div",79)(26,"div",85),_(27,lt,3,5,"span",76),l()(),n(28,"div",86),p(29,"i",87),l()()()()()}if(i&2){let e=s.$implicit;r(5),m("ngClass",X(15,Re,e.type==="template",e.badges.length>0&&e.badges[0].text==="Assembly",e.badges.length>0&&e.badges[0].text==="Purchased",e.badges.length>0&&e.badges[0].text==="Manufactured",e.badges.length>0&&e.badges[0].text==="Modified")),r(),S("bi ",e.icon,""),r(3),S("bi ",e.icon," d-md-none"),r(2),f(e.displayName),r(2),m("ngForOf",e.badges.slice(0,2)),r(3),v(" ",e.subtitle," "),r(5),m("ngIf",e.stats.itemCount!==void 0),r(),m("ngIf",e.stats.childCount!==void 0&&e.stats.childCount>0),r(),m("ngIf",e.stats.usedInCount!==void 0&&e.stats.usedInCount>0),r(),m("ngIf",e.stats.itemCount===0&&e.stats.childCount===0&&e.stats.usedInCount===0),r(3),m("ngForOf",e.badges.slice(2))}}function ot(i,s){if(i&1&&(n(0,"div",19),_(1,rt,30,21,"div",65),l()),i&2){let e=c();r(),m("ngForOf",e.filteredItems)}}var Dt=(()=>{class i{constructor(e,a,t,d){this.bridge=e,this.bomTemplates=a,this.parts=t,this.modalService=d,this.activeTab="all",this.searchQuery="",this.sortBy="name",this.allItems=[],this.filteredItems=[],this.stats={total:0,templates:0,assemblies:0,parts:0},this.loading=!1,this.showTemplateDialog=!1,this.templateForm={name:"",tool_model:"",template_type:"bom"},this.subscriptions=[]}ngOnInit(){this.loadData()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}loadData(){this.loading=!0;let e=this.bridge.listAllItems().subscribe(a=>{this.allItems=a,this.updateStats(),this.applyFilters(),this.loading=!1});this.subscriptions.push(e)}updateStats(){this.stats.total=this.allItems.length,this.stats.templates=this.allItems.filter(e=>e.type==="template").length,this.stats.assemblies=this.allItems.filter(e=>e.type==="part"&&e.badges.some(a=>a.text==="Assembly")).length,this.stats.parts=this.allItems.filter(e=>e.type==="part"&&!e.badges.some(a=>a.text==="Assembly")).length}selectTab(e){this.activeTab=e,this.applyFilters()}applyFilters(){let e=[...this.allItems];switch(this.activeTab){case"templates":e=e.filter(a=>a.type==="template");break;case"assemblies":e=e.filter(a=>a.type==="part"&&a.badges.some(t=>t.text==="Assembly"));break;case"parts":e=e.filter(a=>a.type==="part"&&!a.badges.some(t=>t.text==="Assembly"));break}if(this.searchQuery.trim()){let a=this.searchQuery.toLowerCase();e=e.filter(t=>t.displayName.toLowerCase().includes(a)||t.subtitle.toLowerCase().includes(a))}e=this.sortItems(e),this.filteredItems=e}sortItems(e){switch(this.sortBy){case"name":return e.sort((a,t)=>a.displayName.localeCompare(t.displayName));case"type":return e.sort((a,t)=>a.type!==t.type?a.type==="template"?-1:1:a.displayName.localeCompare(t.displayName));case"recent":return e.reverse();default:return e}}openItem(e){let a=this.modalService.open(pe,{size:"lg",scrollable:!0});a.componentInstance.itemId=e.id,a.componentInstance.itemType=e.type,a.componentInstance.itemUpdated.subscribe(()=>{this.loadData()}),a.result.then(t=>{(t==="converted"||t==="saved")&&this.loadData()},()=>{})}showNewTemplateDialog(){this.templateForm={name:"",tool_model:"",template_type:"bom"},this.showTemplateDialog=!0}handleSaveTemplate(){return C(this,null,function*(){this.templateForm.name.trim()&&(yield this.bomTemplates.createTemplate(this.templateForm.name.trim(),this.templateForm.tool_model.trim()||void 0,this.templateForm.template_type),this.showTemplateDialog=!1,this.loadData())})}cancelTemplateDialog(){this.showTemplateDialog=!1}showNewAssemblyDialog(){let e=this.modalService.open(R,{size:"xl",backdrop:"static"});e.componentInstance.isNew=!0,e.result.then(()=>this.loadData(),()=>{})}showNewPartDialog(){let e=this.modalService.open(R,{size:"xl",backdrop:"static"});e.componentInstance.isNew=!0,e.result.then(()=>this.loadData(),()=>{})}static{this.\u0275fac=function(a){return new(a||i)(w(Q),w(M),w(k),w(re))}}static{this.\u0275cmp=F({type:i,selectors:[["app-unified-catalog"]],standalone:!0,features:[A],decls:69,vars:36,consts:[[1,"container-fluid","py-3"],[1,"page-header","d-flex","flex-column","flex-md-row","justify-content-between","align-items-start","align-items-md-center","gap-2"],[1,"page-title"],[1,"page-subtitle"],[1,"dropdown"],["type","button","data-bs-toggle","dropdown",1,"btn","btn-primary","dropdown-toggle"],[1,"bi","bi-plus-lg","me-1"],[1,"dropdown-menu","dropdown-menu-end"],[1,"dropdown-item",3,"click"],[1,"bi","bi-file-earmark-text","me-2"],[1,"bi","bi-box-seam","me-2"],[1,"bi","bi-circle","me-2"],["class","card mb-3 border-primary",4,"ngIf"],[1,"nav","nav-tabs","mb-3"],[1,"nav-item"],["role","button",1,"nav-link",3,"click"],[1,"badge","ms-1"],[1,"card","filter-bar"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-8"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],["type","search","placeholder","Search by name, description, or tool model...",1,"form-control",3,"ngModelChange","ngModel"],["class","btn btn-outline-secondary",3,"click",4,"ngIf"],[1,"col-md-4"],[1,"form-select",3,"ngModelChange","ngModel"],["value","name"],["value","type"],["value","recent"],[1,"mt-2"],[1,"text-muted"],["class","text-center py-5",4,"ngIf"],["class","card",4,"ngIf"],["class","row g-3",4,"ngIf"],[1,"card","mb-3","border-primary"],[1,"card-header","bg-primary","bg-opacity-10","d-flex","justify-content-between","align-items-center"],[1,"btn-close",3,"click"],[1,"col-md-5"],[1,"form-label"],["type","text","placeholder","e.g. T-100 Assembly BOM","autofocus","",1,"form-control",3,"ngModelChange","keydown.enter","ngModel"],["type","text","placeholder","e.g. T-100, Saw-500",1,"form-control",3,"ngModelChange","keydown.enter","ngModel"],[1,"col-md-3"],["value","bom"],["value","assembly"],[1,"mt-3","d-flex","gap-2","justify-content-end"],[1,"btn","btn-outline-secondary",3,"click"],[1,"btn","btn-primary",3,"click","disabled"],[1,"bi","bi-check-lg","me-1"],[1,"bi","bi-x-lg"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"text-muted","mt-3"],[1,"card"],[1,"card-body","text-center","py-5"],[1,"bi","bi-collection","display-4","text-muted","opacity-50","d-block","mb-3"],[1,"text-muted","mb-3"],["class","d-flex gap-2 justify-content-center",4,"ngIf"],[1,"d-flex","gap-2","justify-content-center"],[1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-file-earmark-text","me-1"],[1,"bi","bi-box-seam","me-1"],[1,"bi","bi-circle","me-1"],["class","col-12",4,"ngFor","ngForOf"],[1,"col-12"],[1,"card","hover-shadow",2,"cursor","pointer",3,"click"],[1,"card-body","py-3"],[1,"row","g-3","align-items-center"],[1,"col-auto","d-none","d-md-block"],[1,"icon-circle","icon-circle-lg",3,"ngClass"],[1,"col-12","col-md-3"],[1,"d-flex","align-items-center","gap-2","mb-1"],[1,"font-monospace","fw-semibold"],[1,"d-flex","flex-wrap","gap-1"],[3,"class",4,"ngFor","ngForOf"],[1,"col-12","col-md-4"],[1,"small","text-muted","text-truncate"],[1,"col-6","col-md-2"],[1,"small","text-muted",2,"font-size","0.75rem"],[1,"small"],["class","fw-medium",4,"ngIf"],["class","text-muted",4,"ngIf"],["class","text-muted fst-italic",4,"ngIf"],[1,"d-flex","flex-wrap","gap-1","justify-content-md-end"],[1,"col-auto","d-none","d-md-block","ms-auto"],[1,"bi","bi-chevron-right","text-muted"],[3,"class",4,"ngIf"],[1,"fw-medium"],[1,"text-muted","fst-italic"]],template:function(a,t){a&1&&(n(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),o(4,"Parts & Templates"),l(),n(5,"p",3),o(6,"Unified catalog for BOM templates and parts"),l()(),n(7,"div",4)(8,"button",5),p(9,"i",6),o(10," New "),l(),n(11,"ul",7)(12,"li")(13,"button",8),u("click",function(){return t.showNewTemplateDialog()}),p(14,"i",9),o(15," Template "),l()(),n(16,"li")(17,"button",8),u("click",function(){return t.showNewAssemblyDialog()}),p(18,"i",10),o(19," Assembly Part "),l()(),n(20,"li")(21,"button",8),u("click",function(){return t.showNewPartDialog()}),p(22,"i",11),o(23," Part "),l()()()()(),_(24,Ge,30,4,"div",12),n(25,"ul",13)(26,"li",14)(27,"a",15),u("click",function(){return t.selectTab("all")}),o(28," All Items "),n(29,"span",16),o(30),l()()(),n(31,"li",14)(32,"a",15),u("click",function(){return t.selectTab("templates")}),o(33," Templates "),n(34,"span",16),o(35),l()()(),n(36,"li",14)(37,"a",15),u("click",function(){return t.selectTab("assemblies")}),o(38," Assemblies "),n(39,"span",16),o(40),l()()(),n(41,"li",14)(42,"a",15),u("click",function(){return t.selectTab("parts")}),o(43," Parts "),n(44,"span",16),o(45),l()()()(),n(46,"div",17)(47,"div",18)(48,"div",19)(49,"div",20)(50,"div",21)(51,"span",22),p(52,"i",23),l(),n(53,"input",24),E("ngModelChange",function(h){return T(t.searchQuery,h)||(t.searchQuery=h),h}),u("ngModelChange",function(){return t.applyFilters()}),l(),_(54,Ye,2,0,"button",25),l()(),n(55,"div",26)(56,"select",27),E("ngModelChange",function(h){return T(t.sortBy,h)||(t.sortBy=h),h}),u("ngModelChange",function(){return t.applyFilters()}),n(57,"option",28),o(58,"Sort by Name"),l(),n(59,"option",29),o(60,"Sort by Type"),l(),n(61,"option",30),o(62,"Sort by Recent"),l()()()(),n(63,"div",31)(64,"small",32),o(65),l()()()(),_(66,He,6,0,"div",33)(67,Ke,6,2,"div",34)(68,ot,2,1,"div",35),l()),a&2&&(r(24),m("ngIf",t.showTemplateDialog),r(3),x("active",t.activeTab==="all"),r(2),x("bg-primary",t.activeTab==="all")("bg-secondary",t.activeTab!=="all"),r(),v(" ",t.stats.total," "),r(2),x("active",t.activeTab==="templates"),r(2),x("bg-primary",t.activeTab==="templates")("bg-secondary",t.activeTab!=="templates"),r(),v(" ",t.stats.templates," "),r(2),x("active",t.activeTab==="assemblies"),r(2),x("bg-primary",t.activeTab==="assemblies")("bg-secondary",t.activeTab!=="assemblies"),r(),v(" ",t.stats.assemblies," "),r(2),x("active",t.activeTab==="parts"),r(2),x("bg-primary",t.activeTab==="parts")("bg-secondary",t.activeTab!=="parts"),r(),v(" ",t.stats.parts," "),r(8),I("ngModel",t.searchQuery),r(),m("ngIf",t.searchQuery),r(2),I("ngModel",t.sortBy),r(9),v(" ",t.filteredItems.length," item(s) "),r(),m("ngIf",t.loading),r(),m("ngIf",!t.loading&&t.filteredItems.length===0),r(),m("ngIf",!t.loading&&t.filteredItems.length>0))},dependencies:[B,O,V,N,$,ee,te,L,Z,j,W],styles:[".icon-circle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:var(--radius-md, .5rem);display:flex;align-items:center;justify-content:center;font-size:1.25rem;flex-shrink:0}.icon-circle-lg[_ngcontent-%COMP%]{width:48px;height:48px;font-size:1.5rem}.icon-circle-blue[_ngcontent-%COMP%]{background-color:var(--brand-primary-subtle, rgba(37, 99, 235, .08));color:var(--brand-primary, #2563eb)}.icon-circle-purple[_ngcontent-%COMP%]{background-color:var(--color-purple-subtle, rgba(124, 58, 237, .08));color:var(--color-purple, #7c3aed)}.icon-circle-green[_ngcontent-%COMP%]{background-color:var(--color-success-subtle, rgba(22, 163, 74, .08));color:var(--color-success, #16a34a)}.icon-circle-amber[_ngcontent-%COMP%]{background-color:var(--color-warning-subtle, rgba(217, 119, 6, .08));color:var(--color-warning, #d97706)}.icon-circle-cyan[_ngcontent-%COMP%]{background-color:var(--color-info-subtle, rgba(8, 145, 178, .08));color:var(--color-info, #0891b2)}.icon-circle-gray[_ngcontent-%COMP%]{background-color:var(--surface-inset, #f1f5f9);color:var(--text-muted, #6b7280)}.hover-shadow[_ngcontent-%COMP%]{transition:box-shadow var(--transition-base, .2s ease),transform var(--transition-base, .2s ease)}.hover-shadow[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md);transform:translateY(-1px)}"]})}}return i})();export{Dt as UnifiedCatalogComponent};
