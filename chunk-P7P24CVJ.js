import{a as E}from"./chunk-KMPFFIFL.js";import{a as ie}from"./chunk-BC7WZKGI.js";import{a as ne,b as ae,c as le}from"./chunk-JG2EF2JX.js";import{a as T,b as re}from"./chunk-SJCJM33I.js";import{b as $,c as j,f as L,i as X,j as Z,k as ee,n as W}from"./chunk-ACCF75FY.js";import{$a as p,$b as F,Bb as K,Ca as r,Da as y,Sa as _,T as Y,Ta as J,Ua as m,Wa as x,Y as k,Ya as I,Za as a,_a as l,_b as N,ac as V,ca as A,cb as C,db as f,dc as B,eb as c,ic as te,ka as v,la as h,mb as o,n as D,nb as u,o as R,ob as g,rb as M,sa as H,sb as U,tb as P,vb as O}from"./chunk-2TFJQIGG.js";import{e as w}from"./chunk-DVOCWXDE.js";var Q=(()=>{class i{constructor(e,n,t,d){this.bomTemplates=e,this.parts=n,this.relationships=t,this.supabase=d}listAllItems(){return R([this.bomTemplates.templates$,this.parts.parts$]).pipe(D(([e,n])=>[...this.mapTemplates(e),...this.mapParts(n)]))}filterTemplates(){return this.bomTemplates.templates$.pipe(D(e=>this.mapTemplates(e)))}filterAssemblies(){return this.parts.parts$.pipe(D(e=>this.mapParts(e.filter(n=>n.is_assembly===!0))))}filterParts(){return this.parts.parts$.pipe(D(e=>this.mapParts(e.filter(n=>n.is_assembly!==!0))))}getItem(e,n){return w(this,null,function*(){if(n==="template"){let t=yield this.bomTemplates.getTemplateWithItems(e);if(!t)throw new Error(`Template not found: ${e}`);return{type:"template",data:t}}else{let t=yield this.parts.getPartWithRelationships(e);if(!t)throw new Error(`Part not found: ${e}`);return{type:"part",data:t}}})}convertTemplateToAssembly(e){return w(this,null,function*(){let n=yield this.bomTemplates.getTemplateWithItems(e);if(!n||!n.items||n.items.length===0)throw new Error("Cannot convert empty template to assembly");let t=`ASSY-${n.tool_model||n.name.replace(/\s+/g,"-")}`,d=yield this.parts.createPart({part_number:t,description:n.name,classification_type:null,is_assembly:!0,is_modified:!1,default_location:null,base_part_id:null,notes:`Converted from template: ${n.name}`});for(let b of n.items){let S=yield this.parts.findOrCreatePart(b.part_number,b.description,b.location,null);yield this.relationships.createRelationship(d.id,S.id,b.qty_per_unit,{notes:b.assembly_group?`Assembly Group: ${b.assembly_group}`:void 0,sortOrder:0})}return yield this.updateTemplateLinkToPart(e,d.id),d})}savePartAsTemplate(e,n){return w(this,null,function*(){let t=yield this.parts.getPartWithRelationships(e);if(!t||!t.children||t.children.length===0)throw new Error("Cannot create template from part with no children");let d=n?.name||t.description||t.part_number,b=n?.toolModel||void 0,S=yield this.bomTemplates.createTemplate(d,b,"assembly");if(!S)throw new Error("Failed to create template");for(let q of t.children){let z=q.part,pe=q.notes?.match(/Assembly Group: (.+)/)?.[1]||null;yield this.bomTemplates.addTemplateItem(S.id,{part_number:z.part_number,description:z.description,location:z.default_location,qty_per_unit:q.quantity,assembly_group:pe})}yield this.updateTemplateLinkToPart(S.id,e);let G=yield this.bomTemplates.getTemplateWithItems(S.id);if(!G)throw new Error("Failed to retrieve created template");return G})}updateTemplateLinkToPart(e,n){return w(this,null,function*(){let{error:t}=yield this.supabase.from("bom_templates").update({part_id:n}).eq("id",e);t&&console.error("Error linking template to part:",t)})}mapTemplates(e){return e.map(n=>({id:n.id,type:"template",displayName:n.name,subtitle:n.tool_model||"No tool model",badges:[{text:n.template_type==="assembly"?"Assembly":"BOM",color:n.template_type==="assembly"?"bg-info":"bg-primary",icon:n.template_type==="assembly"?"bi-boxes":"bi-list-ul"},...n.tool_model?[{text:n.tool_model,color:"bg-secondary",icon:"bi-tools"}]:[]],icon:"bi-file-earmark-text",stats:{itemCount:0}}))}mapParts(e){return e.map(n=>({id:n.id,type:"part",displayName:n.part_number,subtitle:n.description||"No description",badges:[this.getClassificationBadge(n.classification_type),...n.child_count>0?[{text:`${n.child_count} parts`,color:"bg-secondary",icon:"bi-diagram-3"}]:[],...n.used_in_count>0?[{text:`Used in ${n.used_in_count}`,color:"bg-light text-dark",icon:"bi-arrow-up"}]:[]],icon:this.getClassificationIcon(n.classification_type),stats:{childCount:n.child_count,usedInCount:n.used_in_count}}))}getClassificationBadge(e){switch(e){case"manufactured":return{text:"Manufactured",color:"bg-warning text-dark",icon:"bi-gear"};case"purchased":return{text:"Purchased",color:"bg-success",icon:"bi-cart"};default:return{text:"Unclassified",color:"bg-secondary"}}}getClassificationIcon(e){switch(e){case"manufactured":return"bi-gear";case"purchased":return"bi-cart";default:return"bi-circle"}}static{this.\u0275fac=function(n){return new(n||i)(k(E),k(T),k(re),k(te))}}static{this.\u0275prov=Y({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function ge(i,s){if(i&1&&p(0,"i"),i&2){let e=c();I("bi ",e.item.type==="template"?"bi-file-earmark-text":"bi-box-seam"," text-primary")}}function be(i,s){if(i&1&&(a(0,"span"),o(1),l()),i&2){let e=c();r(),u(e.templateData.name)}}function ve(i,s){if(i&1&&(a(0,"span"),o(1),l()),i&2){let e=c();r(),u(e.partData.part_number)}}function he(i,s){if(i&1&&(a(0,"span"),o(1),l()),i&2){let e=c();r(),g("",e.templateData.items.length," items")}}function xe(i,s){if(i&1&&(a(0,"span"),o(1),l()),i&2){let e=c();r(),u(e.partData.description)}}function ye(i,s){i&1&&(a(0,"div",15)(1,"div",16)(2,"span",17),o(3,"Loading..."),l()(),a(4,"p",18),o(5,"Loading..."),l()())}function Ce(i,s){if(i&1&&(a(0,"div",19),p(1,"i",20),o(2),l()),i&2){let e=c();r(2),g("",e.error," ")}}function Ie(i,s){if(i&1&&(a(0,"span",31),p(1,"i",32),o(2),l()),i&2){let e=c(2);r(2),g("",e.templateData.tool_model," ")}}function we(i,s){if(i&1){let e=C();a(0,"div",35),f("click",function(){let t=v(e).$implicit,d=c(3);return h(d.selectAssembly(t.key))}),a(1,"div",2),p(2,"i",40),a(3,"span",41),o(4),l(),a(5,"span",42),o(6),l()()()}if(i&2){let e=s.$implicit,n=c(3);x("active",n.selectedAssemblyFilter===e.key),r(2),m("ngClass",e.key==="__unassigned__"?"bi-puzzle":"bi-box-seam"),r(2),u(e.name),r(),x("bg-secondary",e.key==="__unassigned__")("bg-primary",e.key!=="__unassigned__"),r(),u(e.count)}}function Se(i,s){if(i&1){let e=C();a(0,"div",33)(1,"div",34)(2,"div",35),f("click",function(){v(e);let t=c(2);return h(t.selectAssembly(null))}),a(3,"div",2),p(4,"i",36),a(5,"span",37),o(6,"All Items"),l(),a(7,"span",38),o(8),l()()(),_(9,we,7,9,"div",39),l()()}if(i&2){let e=c(2);r(2),x("active",e.selectedAssemblyFilter===null),r(6),u(e.templateData.items.length),r(),m("ngForOf",e.assemblyGroups)}}function Te(i,s){if(i&1){let e=C();a(0,"button",48),f("click",function(){v(e);let t=c(3);return h(t.templateItemSearch="")}),p(1,"i",49),l()}}function Ee(i,s){if(i&1){let e=C();a(0,"div",21)(1,"div",43)(2,"span",44),p(3,"i",45),l(),a(4,"input",46),P("ngModelChange",function(t){v(e);let d=c(2);return U(d.templateItemSearch,t)||(d.templateItemSearch=t),h(t)}),l(),_(5,Te,2,0,"button",47),l()()}if(i&2){let e=c(2);r(4),M("ngModel",e.templateItemSearch),r(),m("ngIf",e.templateItemSearch)}}function De(i,s){i&1&&(a(0,"th"),o(1,"Assembly"),l())}function ke(i,s){if(i&1&&(a(0,"span",53),o(1),l()),i&2){let e=c(2).$implicit;r(),u(e.assembly_group)}}function Me(i,s){i&1&&(a(0,"span",54),o(1,"Loose"),l())}function Ue(i,s){if(i&1&&(a(0,"td"),_(1,ke,2,1,"span",51)(2,Me,2,0,"span",52),l()),i&2){let e=c().$implicit;r(),m("ngIf",e.assembly_group),r(),m("ngIf",!e.assembly_group)}}function Pe(i,s){if(i&1&&(a(0,"tr")(1,"td",50),o(2),l(),a(3,"td"),o(4),l(),a(5,"td"),o(6),l(),a(7,"td",29),o(8),l(),_(9,Ue,3,2,"td",5),l()),i&2){let e=s.$implicit,n=c(2);r(2),u(e.part_number),r(2),u(e.description||"-"),r(2),u(e.location||"-"),r(2),u(e.qty_per_unit),r(),m("ngIf",n.hasMultipleAssemblies)}}function Ae(i,s){if(i&1&&(a(0,"tr")(1,"td",55),p(2,"i",56),o(3,"No items match your filter "),l()()),i&2){let e=c(2);r(),J("colspan",e.hasMultipleAssemblies?5:4)}}function Oe(i,s){if(i&1&&(a(0,"div")(1,"div",21)(2,"div",22),_(3,Ie,3,1,"span",23),a(4,"span",24),p(5,"i"),o(6),l()()(),_(7,Se,10,4,"div",25)(8,Ee,6,2,"div",26),a(9,"div",27)(10,"table",28)(11,"thead")(12,"tr")(13,"th"),o(14,"Part Number"),l(),a(15,"th"),o(16,"Description"),l(),a(17,"th"),o(18,"Location"),l(),a(19,"th",29),o(20,"Qty"),l(),_(21,De,2,0,"th",5),l()(),a(22,"tbody"),_(23,Pe,10,5,"tr",30)(24,Ae,4,1,"tr",5),l()()()()),i&2){let e=c();r(3),m("ngIf",e.templateData.tool_model),r(2),I("bi bi-",e.templateData.template_type==="assembly"?"boxes":"list-ul"," me-1"),r(),g(" ",e.templateData.template_type==="assembly"?"Assembly":"BOM"," "),r(),m("ngIf",e.hasMultipleAssemblies),r(),m("ngIf",e.templateData.items.length>0),r(13),m("ngIf",e.hasMultipleAssemblies),r(2),m("ngForOf",e.filteredTemplateItems),r(),m("ngIf",e.filteredTemplateItems.length===0)}}function Ne(i,s){if(i&1&&(a(0,"div",66)(1,"label",61),o(2,"Notes"),l(),a(3,"div",37),o(4),l()()),i&2){let e=c(2);r(4),u(e.partData.notes)}}function Fe(i,s){if(i&1&&(a(0,"tr")(1,"td",50),o(2),l(),a(3,"td"),o(4),l(),a(5,"td"),o(6),l(),a(7,"td"),o(8),l()()),i&2){let e=s.$implicit;r(2),u(e.part.part_number),r(2),u(e.part.description||"-"),r(2),u(e.quantity),r(2),u(e.reference_designator||"-")}}function Ve(i,s){if(i&1&&(a(0,"div",21)(1,"h6",67),o(2),l(),a(3,"div",27)(4,"table",28)(5,"thead")(6,"tr")(7,"th"),o(8,"Part Number"),l(),a(9,"th"),o(10,"Description"),l(),a(11,"th"),o(12,"Qty"),l(),a(13,"th"),o(14,"Ref Des"),l()()(),a(15,"tbody"),_(16,Fe,9,4,"tr",30),l()()()()),i&2){let e=c(2);r(2),g("Bill of Materials (",e.partData.children.length," parts)"),r(14),m("ngForOf",e.partData.children)}}function Be(i,s){if(i&1&&(a(0,"span",73),o(1),l()),i&2){let e=c().$implicit;r(),u(e.part.description)}}function $e(i,s){if(i&1&&(a(0,"div",70)(1,"div",71)(2,"div")(3,"span",50),o(4),l(),_(5,Be,2,1,"span",72),l(),a(6,"span",31),o(7),l()()()),i&2){let e=s.$implicit;r(4),u(e.part.part_number),r(),m("ngIf",e.part.description),r(2),g("Qty: ",e.quantity,"")}}function je(i,s){if(i&1&&(a(0,"div",21)(1,"h6",67),o(2),l(),a(3,"div",68),_(4,$e,8,3,"div",69),l()()),i&2){let e=c(2);r(2),g("Used In (",e.partData.used_in.length," assemblies)"),r(2),m("ngForOf",e.partData.used_in)}}function Le(i,s){i&1&&(a(0,"div",74),p(1,"i",75),a(2,"p"),o(3,"This part has no BOM relationships yet"),l()())}function We(i,s){if(i&1&&(a(0,"div")(1,"div",57)(2,"div",58)(3,"div",59)(4,"div",60)(5,"label",61),o(6,"Part Number"),l(),a(7,"div",62),o(8),l()(),a(9,"div",60)(10,"label",61),o(11,"Classification"),l(),a(12,"div"),p(13,"app-classification-badge",63),l()(),a(14,"div",60)(15,"label",61),o(16,"Description"),l(),a(17,"div"),o(18),l()(),a(19,"div",60)(20,"label",61),o(21,"Location"),l(),a(22,"div"),o(23),l()(),_(24,Ne,5,1,"div",64),l()()(),_(25,Ve,17,2,"div",26)(26,je,5,2,"div",26)(27,Le,4,0,"div",65),l()),i&2){let e=c();r(8),u(e.partData.part_number),r(5),m("classification",e.partData.classification_type),r(5),u(e.partData.description||"-"),r(5),u(e.partData.default_location||"-"),r(),m("ngIf",e.partData.notes),r(),m("ngIf",e.partData.children&&e.partData.children.length>0),r(),m("ngIf",e.partData.used_in&&e.partData.used_in.length>0),r(),m("ngIf",e.partData.children.length===0&&e.partData.used_in.length===0)}}function Qe(i,s){if(i&1){let e=C();a(0,"button",76),f("click",function(){v(e);let t=c();return h(t.convertToAssembly())}),p(1,"i",77),o(2," Upgrade to Engineering BOM "),l()}}function qe(i,s){if(i&1){let e=C();a(0,"button",76),f("click",function(){v(e);let t=c();return h(t.saveAsTemplate())}),p(1,"i",78),o(2," Save as Template "),l()}}var de=(()=>{class i{constructor(e,n,t,d,b){this.activeModal=e,this.bridge=n,this.bomTemplates=t,this.parts=d,this.toast=b,this.itemUpdated=new H,this.item=null,this.loading=!0,this.error=null,this.selectedAssemblyFilter=null,this.assemblyGroups=[],this.hasMultipleAssemblies=!1,this.templateItemSearch=""}ngOnInit(){this.loadItem()}loadItem(){return w(this,null,function*(){try{this.loading=!0,this.error=null,this.item=yield this.bridge.getItem(this.itemId,this.itemType),this.item.type==="template"&&this.initializeTemplateView(),this.loading=!1}catch(e){this.error=e instanceof Error?e.message:"Failed to load item",this.loading=!1}})}initializeTemplateView(){if(this.item?.type!=="template")return;let e=this.item.data,n=new Map;e.items.forEach(t=>{let d=t.assembly_group||"__unassigned__";n.set(d,(n.get(d)||0)+1)}),this.assemblyGroups=Array.from(n.entries()).map(([t,d])=>({name:t==="__unassigned__"?"Loose Parts":t,key:t,count:d})).sort((t,d)=>t.key==="__unassigned__"?1:d.key==="__unassigned__"?-1:t.name.localeCompare(d.name)),this.hasMultipleAssemblies=this.assemblyGroups.length>=2}get templateData(){return this.item?.type==="template"?this.item.data:null}get partData(){return this.item?.type==="part"?this.item.data:null}get filteredTemplateItems(){if(!this.templateData)return[];let e=this.templateData.items;if(this.selectedAssemblyFilter!==null&&(e=e.filter(n=>(n.assembly_group||"__unassigned__")===this.selectedAssemblyFilter)),this.templateItemSearch.trim()){let n=this.templateItemSearch.toLowerCase();e=e.filter(t=>t.part_number.toLowerCase().includes(n)||t.description&&t.description.toLowerCase().includes(n)||t.location&&t.location.toLowerCase().includes(n))}return e}selectAssembly(e){this.selectedAssemblyFilter=e}get activeFilterName(){if(!this.selectedAssemblyFilter)return"All Items";let e=this.assemblyGroups.find(n=>n.key===this.selectedAssemblyFilter);return e?e.name:"Unknown"}convertToAssembly(){return w(this,null,function*(){if(this.templateData&&confirm(`Convert "${this.templateData.name}" to an engineering BOM assembly part?

This will create a new assembly part with full BOM relationships.`))try{this.loading=!0;let e=yield this.bridge.convertTemplateToAssembly(this.templateData.id);this.toast.success(`Successfully created assembly part: ${e.part_number}`),this.itemUpdated.emit(),this.activeModal.close("converted")}catch(e){this.toast.error(e instanceof Error?e.message:"Failed to convert template"),this.loading=!1}})}saveAsTemplate(){return w(this,null,function*(){if(!this.partData)return;let e=prompt("Enter template name:",this.partData.description||this.partData.part_number);if(e)try{this.loading=!0;let n=yield this.bridge.savePartAsTemplate(this.partData.id,{name:e});this.toast.success(`Successfully created template: ${n.name}`),this.itemUpdated.emit(),this.activeModal.close("saved")}catch(n){this.toast.error(n instanceof Error?n.message:"Failed to save as template"),this.loading=!1}})}close(){this.activeModal.dismiss()}static{this.\u0275fac=function(n){return new(n||i)(y(ae),y(Q),y(E),y(T),y(ie))}}static{this.\u0275cmp=A({type:i,selectors:[["app-unified-detail"]],inputs:{itemId:"itemId",itemType:"itemType"},outputs:{itemUpdated:"itemUpdated"},standalone:!0,features:[O],decls:23,vars:11,consts:[[1,"modal-header"],[1,"flex-grow-1"],[1,"d-flex","align-items-center","gap-2"],[3,"class",4,"ngIf"],[1,"modal-title","mb-0"],[4,"ngIf"],[1,"text-muted"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","text-center py-5",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"modal-footer"],[1,"d-flex","justify-content-between","w-100"],["class","btn btn-outline-primary btn-sm",3,"click",4,"ngIf"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"text-muted","mt-3"],[1,"alert","alert-danger"],[1,"bi","bi-exclamation-triangle","me-2"],[1,"mb-3"],[1,"d-flex","flex-wrap","gap-2","mb-2"],["class","badge bg-secondary",4,"ngIf"],[1,"badge","bg-info"],["class","assembly-group-cards mb-3",4,"ngIf"],["class","mb-3",4,"ngIf"],[1,"table-responsive"],[1,"table","table-sm","table-hover"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"badge","bg-secondary"],[1,"bi","bi-tools","me-1"],[1,"assembly-group-cards","mb-3"],[1,"d-flex","flex-wrap","gap-2"],["role","button",1,"assembly-card-mini",3,"click"],[1,"bi","bi-list-task"],[1,"small"],[1,"badge","bg-primary","ms-auto"],["class","assembly-card-mini","role","button",3,"active","click",4,"ngFor","ngForOf"],[1,"bi",3,"ngClass"],[1,"small","text-truncate",2,"max-width","120px"],[1,"badge","ms-auto"],[1,"input-group","input-group-sm"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Search items...",1,"form-control",3,"ngModelChange","ngModel"],["class","btn btn-outline-secondary",3,"click",4,"ngIf"],[1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-x-lg"],[1,"font-monospace"],["class","badge bg-light text-dark small",4,"ngIf"],["class","text-muted fst-italic small",4,"ngIf"],[1,"badge","bg-light","text-dark","small"],[1,"text-muted","fst-italic","small"],[1,"text-center","text-muted","py-3"],[1,"bi","bi-funnel","me-2"],[1,"card","mb-3"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label","small","text-muted"],[1,"fw-semibold","font-monospace"],[3,"classification"],["class","col-12",4,"ngIf"],["class","text-center text-muted py-4",4,"ngIf"],[1,"col-12"],[1,"mb-2"],[1,"list-group","list-group-sm"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex","justify-content-between","align-items-center"],["class","text-muted small ms-2",4,"ngIf"],[1,"text-muted","small","ms-2"],[1,"text-center","text-muted","py-4"],[1,"bi","bi-diagram-3","display-4","opacity-50","d-block","mb-2"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"bi","bi-arrow-right-circle","me-1"],[1,"bi","bi-save","me-1"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),_(3,ge,1,3,"i",3),a(4,"h5",4),_(5,be,2,1,"span",5)(6,ve,2,1,"span",5),l()(),a(7,"small",6),_(8,he,2,1,"span",5)(9,xe,2,1,"span",5),l()(),a(10,"button",7),f("click",function(){return t.close()}),l()(),a(11,"div",8),_(12,ye,6,0,"div",9)(13,Ce,3,1,"div",10)(14,Oe,25,10,"div",5)(15,We,28,8,"div",5),l(),a(16,"div",11)(17,"div",12)(18,"div"),_(19,Qe,3,0,"button",13)(20,qe,3,0,"button",13),l(),a(21,"button",14),f("click",function(){return t.close()}),o(22,"Close"),l()()()),n&2&&(r(3),m("ngIf",t.item),r(2),m("ngIf",t.templateData),r(),m("ngIf",t.partData),r(2),m("ngIf",t.templateData),r(),m("ngIf",t.partData),r(3),m("ngIf",t.loading),r(),m("ngIf",t.error&&!t.loading),r(),m("ngIf",!t.loading&&t.templateData),r(),m("ngIf",!t.loading&&t.partData),r(4),m("ngIf",t.templateData),r(),m("ngIf",t.partData&&t.partData.children.length>0))},dependencies:[B,N,F,V,W,$,j,L,ne],styles:[".assembly-card-mini[_ngcontent-%COMP%]{padding:.5rem .75rem;border:1px solid #dee2e6;border-radius:.375rem;background:#fff;transition:all .2s ease;cursor:pointer;min-width:140px}.assembly-card-mini[_ngcontent-%COMP%]:hover{background:#f8f9fa;border-color:#0d6efd}.assembly-card-mini.active[_ngcontent-%COMP%]{background:#e7f1ff;border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd1a}.assembly-group-cards[_ngcontent-%COMP%]{overflow-x:auto;-webkit-overflow-scrolling:touch}.assembly-group-cards[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}.assembly-group-cards[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.assembly-group-cards[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:4px}.table-sm[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table-sm[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem;vertical-align:middle}.list-group-sm[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]{padding:.5rem .75rem}"]})}}return i})();var ze=(i,s,e,n,t)=>({"icon-circle-blue":i,"icon-circle-purple":s,"icon-circle-green":e,"icon-circle-amber":n,"icon-circle-cyan":t});function Ge(i,s){if(i&1){let e=C();a(0,"button",35),f("click",function(){v(e);let t=c();return t.searchQuery="",h(t.applyFilters())}),p(1,"i",36),l()}}function Re(i,s){i&1&&(a(0,"div",37)(1,"div",38)(2,"span",39),o(3,"Loading..."),l()(),a(4,"p",40),o(5,"Loading items..."),l()())}function Ye(i,s){if(i&1){let e=C();a(0,"div",46)(1,"button",47),f("click",function(){v(e);let t=c(2);return h(t.showNewTemplateDialog())}),p(2,"i",48),o(3," New Template "),l(),a(4,"button",47),f("click",function(){v(e);let t=c(2);return h(t.showNewAssemblyDialog())}),p(5,"i",49),o(6," New Assembly "),l(),a(7,"button",47),f("click",function(){v(e);let t=c(2);return h(t.showNewPartDialog())}),p(8,"i",50),o(9," New Part "),l()()}}function He(i,s){if(i&1&&(a(0,"div",41)(1,"div",42),p(2,"i",43),a(3,"p",44),o(4),l(),_(5,Ye,10,0,"div",45),l()()),i&2){let e=c();r(4),g(" ",e.searchQuery?"No items match your search":"No items yet. Create one to get started."," "),r(),m("ngIf",!e.searchQuery)}}function Je(i,s){if(i&1&&p(0,"i"),i&2){let e=c().$implicit;I("bi ",e.icon," me-1")}}function Ke(i,s){if(i&1&&(a(0,"span"),_(1,Je,1,3,"i",74),o(2),l()),i&2){let e=s.$implicit;I("badge ",e.color,""),r(),m("ngIf",e.icon),r(),g("",e.text," ")}}function Xe(i,s){if(i&1&&(a(0,"span",75),o(1),l()),i&2){let e=c().$implicit;r(),g(" ",e.stats.itemCount," items ")}}function Ze(i,s){if(i&1&&(a(0,"span",75),o(1),l()),i&2){let e=c().$implicit;r(),g(" ",e.stats.childCount," parts ")}}function et(i,s){if(i&1&&(a(0,"span",31),o(1),l()),i&2){let e=c().$implicit;r(),g(" \u2022 ",e.stats.usedInCount," assy ")}}function tt(i,s){i&1&&(a(0,"span",76),o(1," \u2014 "),l())}function it(i,s){if(i&1&&p(0,"i"),i&2){let e=c().$implicit;I("bi ",e.icon," me-1")}}function nt(i,s){if(i&1&&(a(0,"span"),_(1,it,1,3,"i",74),o(2),l()),i&2){let e=s.$implicit;I("badge ",e.color," small"),r(),m("ngIf",e.icon),r(),g("",e.text," ")}}function at(i,s){if(i&1){let e=C();a(0,"div",52)(1,"div",53),f("click",function(){let t=v(e).$implicit,d=c(2);return h(d.openItem(t))}),a(2,"div",54)(3,"div",55)(4,"div",56)(5,"div",57),p(6,"i"),l()(),a(7,"div",58)(8,"div",59),p(9,"i"),a(10,"div",60),o(11),l()(),a(12,"div",61),_(13,Ke,3,5,"span",62),l()(),a(14,"div",63)(15,"div",64),o(16),l()(),a(17,"div",65)(18,"div",66),o(19,"Stats"),l(),a(20,"div",67),_(21,Xe,2,1,"span",68)(22,Ze,2,1,"span",68)(23,et,2,1,"span",69)(24,tt,2,0,"span",70),l()(),a(25,"div",65)(26,"div",71),_(27,nt,3,5,"span",62),l()(),a(28,"div",72),p(29,"i",73),l()()()()()}if(i&2){let e=s.$implicit;r(5),m("ngClass",K(15,ze,e.type==="template",e.badges.length>0&&e.badges[0].text==="Assembly",e.badges.length>0&&e.badges[0].text==="Purchased",e.badges.length>0&&e.badges[0].text==="Manufactured",e.badges.length>0&&e.badges[0].text==="Modified")),r(),I("bi ",e.icon,""),r(3),I("bi ",e.icon," d-md-none"),r(2),u(e.displayName),r(2),m("ngForOf",e.badges.slice(0,2)),r(3),g(" ",e.subtitle," "),r(5),m("ngIf",e.stats.itemCount!==void 0),r(),m("ngIf",e.stats.childCount!==void 0&&e.stats.childCount>0),r(),m("ngIf",e.stats.usedInCount!==void 0&&e.stats.usedInCount>0),r(),m("ngIf",e.stats.itemCount===0&&e.stats.childCount===0&&e.stats.usedInCount===0),r(3),m("ngForOf",e.badges.slice(2))}}function lt(i,s){if(i&1&&(a(0,"div",18),_(1,at,30,21,"div",51),l()),i&2){let e=c();r(),m("ngForOf",e.filteredItems)}}var St=(()=>{class i{constructor(e,n,t,d){this.bridge=e,this.bomTemplates=n,this.parts=t,this.modalService=d,this.activeTab="all",this.searchQuery="",this.sortBy="name",this.allItems=[],this.filteredItems=[],this.stats={total:0,templates:0,assemblies:0,parts:0},this.loading=!1,this.subscriptions=[]}ngOnInit(){this.loadData()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}loadData(){this.loading=!0;let e=this.bridge.listAllItems().subscribe(n=>{this.allItems=n,this.updateStats(),this.applyFilters(),this.loading=!1});this.subscriptions.push(e)}updateStats(){this.stats.total=this.allItems.length,this.stats.templates=this.allItems.filter(e=>e.type==="template").length,this.stats.assemblies=this.allItems.filter(e=>e.type==="part"&&e.badges.some(n=>n.text==="Assembly")).length,this.stats.parts=this.allItems.filter(e=>e.type==="part"&&!e.badges.some(n=>n.text==="Assembly")).length}selectTab(e){this.activeTab=e,this.applyFilters()}applyFilters(){let e=[...this.allItems];switch(this.activeTab){case"templates":e=e.filter(n=>n.type==="template");break;case"assemblies":e=e.filter(n=>n.type==="part"&&n.badges.some(t=>t.text==="Assembly"));break;case"parts":e=e.filter(n=>n.type==="part"&&!n.badges.some(t=>t.text==="Assembly"));break}if(this.searchQuery.trim()){let n=this.searchQuery.toLowerCase();e=e.filter(t=>t.displayName.toLowerCase().includes(n)||t.subtitle.toLowerCase().includes(n))}e=this.sortItems(e),this.filteredItems=e}sortItems(e){switch(this.sortBy){case"name":return e.sort((n,t)=>n.displayName.localeCompare(t.displayName));case"type":return e.sort((n,t)=>n.type!==t.type?n.type==="template"?-1:1:n.displayName.localeCompare(t.displayName));case"recent":return e.reverse();default:return e}}openItem(e){let n=this.modalService.open(de,{size:"lg",scrollable:!0});n.componentInstance.itemId=e.id,n.componentInstance.itemType=e.type,n.componentInstance.itemUpdated.subscribe(()=>{this.loadData()}),n.result.then(t=>{(t==="converted"||t==="saved")&&this.loadData()},()=>{})}showNewTemplateDialog(){console.log("New template")}showNewAssemblyDialog(){console.log("New assembly")}showNewPartDialog(){console.log("New part")}static{this.\u0275fac=function(n){return new(n||i)(y(Q),y(E),y(T),y(le))}}static{this.\u0275cmp=A({type:i,selectors:[["app-unified-catalog"]],standalone:!0,features:[O],decls:68,vars:35,consts:[[1,"container-fluid","py-3"],[1,"page-header","d-flex","flex-column","flex-md-row","justify-content-between","align-items-start","align-items-md-center","gap-2"],[1,"page-title"],[1,"page-subtitle"],[1,"dropdown"],["type","button","data-bs-toggle","dropdown",1,"btn","btn-primary","dropdown-toggle"],[1,"bi","bi-plus-lg","me-1"],[1,"dropdown-menu","dropdown-menu-end"],[1,"dropdown-item",3,"click"],[1,"bi","bi-file-earmark-text","me-2"],[1,"bi","bi-box-seam","me-2"],[1,"bi","bi-circle","me-2"],[1,"nav","nav-tabs","mb-3"],[1,"nav-item"],["role","button",1,"nav-link",3,"click"],[1,"badge","ms-1"],[1,"card","filter-bar"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-8"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],["type","search","placeholder","Search by name, description, or tool model...",1,"form-control",3,"ngModelChange","ngModel"],["class","btn btn-outline-secondary",3,"click",4,"ngIf"],[1,"col-md-4"],[1,"form-select",3,"ngModelChange","ngModel"],["value","name"],["value","type"],["value","recent"],[1,"mt-2"],[1,"text-muted"],["class","text-center py-5",4,"ngIf"],["class","card",4,"ngIf"],["class","row g-3",4,"ngIf"],[1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-x-lg"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"text-muted","mt-3"],[1,"card"],[1,"card-body","text-center","py-5"],[1,"bi","bi-collection","display-4","text-muted","opacity-50","d-block","mb-3"],[1,"text-muted","mb-3"],["class","d-flex gap-2 justify-content-center",4,"ngIf"],[1,"d-flex","gap-2","justify-content-center"],[1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-file-earmark-text","me-1"],[1,"bi","bi-box-seam","me-1"],[1,"bi","bi-circle","me-1"],["class","col-12",4,"ngFor","ngForOf"],[1,"col-12"],[1,"card","hover-shadow",2,"cursor","pointer",3,"click"],[1,"card-body","py-3"],[1,"row","g-3","align-items-center"],[1,"col-auto","d-none","d-md-block"],[1,"icon-circle","icon-circle-lg",3,"ngClass"],[1,"col-12","col-md-3"],[1,"d-flex","align-items-center","gap-2","mb-1"],[1,"font-monospace","fw-semibold"],[1,"d-flex","flex-wrap","gap-1"],[3,"class",4,"ngFor","ngForOf"],[1,"col-12","col-md-4"],[1,"small","text-muted","text-truncate"],[1,"col-6","col-md-2"],[1,"small","text-muted",2,"font-size","0.75rem"],[1,"small"],["class","fw-medium",4,"ngIf"],["class","text-muted",4,"ngIf"],["class","text-muted fst-italic",4,"ngIf"],[1,"d-flex","flex-wrap","gap-1","justify-content-md-end"],[1,"col-auto","d-none","d-md-block","ms-auto"],[1,"bi","bi-chevron-right","text-muted"],[3,"class",4,"ngIf"],[1,"fw-medium"],[1,"text-muted","fst-italic"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),o(4,"Parts & Templates"),l(),a(5,"p",3),o(6,"Unified catalog for BOM templates and parts"),l()(),a(7,"div",4)(8,"button",5),p(9,"i",6),o(10," New "),l(),a(11,"ul",7)(12,"li")(13,"button",8),f("click",function(){return t.showNewTemplateDialog()}),p(14,"i",9),o(15," Template "),l()(),a(16,"li")(17,"button",8),f("click",function(){return t.showNewAssemblyDialog()}),p(18,"i",10),o(19," Assembly Part "),l()(),a(20,"li")(21,"button",8),f("click",function(){return t.showNewPartDialog()}),p(22,"i",11),o(23," Part "),l()()()()(),a(24,"ul",12)(25,"li",13)(26,"a",14),f("click",function(){return t.selectTab("all")}),o(27," All Items "),a(28,"span",15),o(29),l()()(),a(30,"li",13)(31,"a",14),f("click",function(){return t.selectTab("templates")}),o(32," Templates "),a(33,"span",15),o(34),l()()(),a(35,"li",13)(36,"a",14),f("click",function(){return t.selectTab("assemblies")}),o(37," Assemblies "),a(38,"span",15),o(39),l()()(),a(40,"li",13)(41,"a",14),f("click",function(){return t.selectTab("parts")}),o(42," Parts "),a(43,"span",15),o(44),l()()()(),a(45,"div",16)(46,"div",17)(47,"div",18)(48,"div",19)(49,"div",20)(50,"span",21),p(51,"i",22),l(),a(52,"input",23),P("ngModelChange",function(b){return U(t.searchQuery,b)||(t.searchQuery=b),b}),f("ngModelChange",function(){return t.applyFilters()}),l(),_(53,Ge,2,0,"button",24),l()(),a(54,"div",25)(55,"select",26),P("ngModelChange",function(b){return U(t.sortBy,b)||(t.sortBy=b),b}),f("ngModelChange",function(){return t.applyFilters()}),a(56,"option",27),o(57,"Sort by Name"),l(),a(58,"option",28),o(59,"Sort by Type"),l(),a(60,"option",29),o(61,"Sort by Recent"),l()()()(),a(62,"div",30)(63,"small",31),o(64),l()()()(),_(65,Re,6,0,"div",32)(66,He,6,2,"div",33)(67,lt,2,1,"div",34),l()),n&2&&(r(26),x("active",t.activeTab==="all"),r(2),x("bg-primary",t.activeTab==="all")("bg-secondary",t.activeTab!=="all"),r(),g(" ",t.stats.total," "),r(2),x("active",t.activeTab==="templates"),r(2),x("bg-primary",t.activeTab==="templates")("bg-secondary",t.activeTab!=="templates"),r(),g(" ",t.stats.templates," "),r(2),x("active",t.activeTab==="assemblies"),r(2),x("bg-primary",t.activeTab==="assemblies")("bg-secondary",t.activeTab!=="assemblies"),r(),g(" ",t.stats.assemblies," "),r(2),x("active",t.activeTab==="parts"),r(2),x("bg-primary",t.activeTab==="parts")("bg-secondary",t.activeTab!=="parts"),r(),g(" ",t.stats.parts," "),r(8),M("ngModel",t.searchQuery),r(),m("ngIf",t.searchQuery),r(2),M("ngModel",t.sortBy),r(9),g(" ",t.filteredItems.length," item(s) "),r(),m("ngIf",t.loading),r(),m("ngIf",!t.loading&&t.filteredItems.length===0),r(),m("ngIf",!t.loading&&t.filteredItems.length>0))},dependencies:[B,N,F,V,W,Z,ee,$,X,j,L],styles:[".icon-circle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:var(--radius-md, .5rem);display:flex;align-items:center;justify-content:center;font-size:1.25rem;flex-shrink:0}.icon-circle-lg[_ngcontent-%COMP%]{width:48px;height:48px;font-size:1.5rem}.icon-circle-blue[_ngcontent-%COMP%]{background-color:var(--brand-primary-subtle, rgba(37, 99, 235, .08));color:var(--brand-primary, #2563eb)}.icon-circle-purple[_ngcontent-%COMP%]{background-color:var(--color-purple-subtle, rgba(124, 58, 237, .08));color:var(--color-purple, #7c3aed)}.icon-circle-green[_ngcontent-%COMP%]{background-color:var(--color-success-subtle, rgba(22, 163, 74, .08));color:var(--color-success, #16a34a)}.icon-circle-amber[_ngcontent-%COMP%]{background-color:var(--color-warning-subtle, rgba(217, 119, 6, .08));color:var(--color-warning, #d97706)}.icon-circle-cyan[_ngcontent-%COMP%]{background-color:var(--color-info-subtle, rgba(8, 145, 178, .08));color:var(--color-info, #0891b2)}.icon-circle-gray[_ngcontent-%COMP%]{background-color:var(--surface-inset, #f1f5f9);color:var(--text-muted, #6b7280)}.hover-shadow[_ngcontent-%COMP%]{transition:box-shadow var(--transition-base, .2s ease),transform var(--transition-base, .2s ease)}.hover-shadow[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md);transform:translateY(-1px)}"]})}}return i})();export{St as UnifiedCatalogComponent};
