import{a as G}from"./chunk-WLYUEHG5.js";import{a as H}from"./chunk-V3DYSMA6.js";import{a as z}from"./chunk-JMCLK4XY.js";import{a as q}from"./chunk-6CNJLGU4.js";import{f as L,i as j}from"./chunk-SJKOT4HS.js";import{b as A,c as U,f as W,n as B}from"./chunk-ACCF75FY.js";import{$a as b,$b as V,Ca as s,Da as g,Sa as _,Ua as d,Va as T,Wa as f,Za as n,_a as i,_b as P,ac as $,ca as E,cb as h,db as v,dc as D,eb as u,ka as I,la as x,mb as r,nb as y,o as w,ob as m,pb as k,rb as R,sb as F,tb as M,vb as N,xb as O}from"./chunk-2TFJQIGG.js";import{e as C}from"./chunk-DVOCWXDE.js";var X=t=>["/orders",t];function Y(t,p){t&1&&(n(0,"div",28)(1,"div",29),r(2,"Loading issues..."),i()())}function Z(t,p){if(t&1&&(n(0,"div",28)(1,"div",30),b(2,"i",31),n(3,"p",32),r(4),i()()()),t&2){let e=u();s(4),m(" ",e.statusFilter==="open"?"No open issues!":"No issues found"," ")}}function ee(t,p){if(t&1&&(n(0,"a",46),r(1),i()),t&2){let e=u().$implicit;d("routerLink",O(2,X,e.order_id)),s(),m(" SO-",e.so_number," ")}}function te(t,p){if(t&1&&(n(0,"p",47),r(1),i()),t&2){let e=u().$implicit;s(),m(" ",e.part_number," ")}}function ie(t,p){if(t&1&&(n(0,"p",48),r(1),i()),t&2){let e=u().$implicit;s(),y(e.description)}}function se(t,p){if(t&1&&(n(0,"span"),r(1),i()),t&2){let e=u().$implicit;s(),m("Reported by ",e.reported_by,"")}}function ne(t,p){if(t&1&&(n(0,"span"),r(1),i()),t&2){let e=u().$implicit,l=u(2);s(),k(" | Resolved by ",e.resolved_by||"Unknown"," on ",l.utils.formatDateTime(e.resolved_at)," ")}}function oe(t,p){if(t&1){let e=h();n(0,"button",49),v("click",function(){I(e);let o=u().$implicit,c=u(2);return x(c.handleResolveIssue(o))}),b(1,"i",26),r(2," Resolve "),i()}}function re(t,p){if(t&1){let e=h();n(0,"button",50),v("click",function(){I(e);let o=u().$implicit,c=u(2);return x(c.handleReopenIssue(o))}),b(1,"i",51),r(2," Reopen "),i()}}function ae(t,p){if(t&1&&(n(0,"div",28)(1,"div",6)(2,"div",35)(3,"div",36)(4,"div",37)(5,"span",38),r(6),i(),n(7,"span",38),r(8),i(),n(9,"span",38),r(10),i(),_(11,ee,2,4,"a",39),i(),_(12,te,2,1,"p",40)(13,ie,2,1,"p",41),n(14,"div",42),_(15,se,2,1,"span",43),n(16,"span"),r(17),i(),_(18,ne,2,2,"span",43),i()(),n(19,"div"),_(20,oe,3,0,"button",44)(21,re,3,0,"button",45),i()()()()),t&2){let e=p.$implicit,l=u(2);f("border-danger",e.status==="open")("border-success",e.status==="resolved")("opacity-75",e.status==="resolved"),s(5),d("ngClass",l.utils.getIssueTypeBadgeClass(e.issue_type)),s(),m(" ",l.utils.getIssueTypeLabel(e.issue_type)," "),s(),d("ngClass",e.status==="open"?"bg-danger":"bg-success"),s(),m(" ",e.status==="open"?"Open":"Resolved"," "),s(),d("ngClass",e.source==="order"?"bg-primary-subtle text-primary border border-primary-subtle":"bg-info-subtle text-info border border-info-subtle"),s(),m(" ",e.source==="order"?"Order":"Part"," "),s(),d("ngIf",e.source==="order"&&e.order_id),s(),d("ngIf",e.part_number),s(),d("ngIf",e.description),s(2),d("ngIf",e.reported_by),s(2),m(" on ",l.utils.formatDateTime(e.created_at),""),s(),d("ngIf",e.status==="resolved"&&e.resolved_at),s(2),d("ngIf",e.status==="open"),s(),d("ngIf",e.status==="resolved")}}function le(t,p){if(t&1&&(n(0,"div",33),_(1,ae,22,20,"div",34),i()),t&2){let e=u();s(),d("ngForOf",e.filteredIssues)}}function de(t,p){if(t&1&&(n(0,"div",53)(1,"strong"),r(2,"SO:"),i(),r(3),i()),t&2){let e=u(2);s(3),m(" ",e.resolveTarget.so_number," ")}}function ue(t,p){if(t&1){let e=h();n(0,"div",52)(1,"p"),r(2,"Are you sure you want to resolve this issue?"),i(),n(3,"div",53)(4,"strong"),r(5,"Part:"),i(),r(6),i(),_(7,de,4,1,"div",54),n(8,"div",53)(9,"strong"),r(10,"Issue:"),i(),r(11),i(),n(12,"div",53)(13,"label",55),r(14,"Resolution Explanation"),i(),n(15,"textarea",56),M("ngModelChange",function(o){I(e);let c=u();return F(c.resolutionNotes,o)||(c.resolutionNotes=o),x(o)}),i(),n(16,"small",57),r(17,"Describe how the issue was resolved"),i()()()}if(t&2){let e=u();s(6),m(" ",e.resolveTarget.part_number||"N/A"," "),s(),d("ngIf",e.resolveTarget.so_number),s(4),m(" ",e.utils.getIssueTypeLabel(e.resolveTarget.issue_type)," "),s(4),R("ngModel",e.resolutionNotes)}}function ce(t,p){t&1&&b(0,"div",58)}var Se=(()=>{class t{constructor(e,l,o,c){this.issuesService=e,this.partIssuesService=l,this.settingsService=o,this.utils=c,this.unifiedIssues=[],this.loading=!0,this.statusFilter="open",this.showResolveModal=!1,this.resolveTarget=null,this.resolutionNotes="",this.subscriptions=[]}ngOnInit(){this.issuesService.loadAllIssues(),this.partIssuesService.initialize(),this.subscriptions.push(w([this.issuesService.issues$,this.partIssuesService.issues$,this.issuesService.loading$,this.partIssuesService.loading$]).subscribe(([e,l,o,c])=>{this.loading=o||c;let J=e.map(a=>({id:a.id,source:"order",issue_type:a.issue_type,description:a.description,reported_by:a.reported_by,status:a.status,created_at:a.created_at,resolved_at:a.resolved_at,resolved_by:a.resolved_by,resolution_notes:a.resolution_notes,part_number:a.line_item?.part_number||null,so_number:a.order?.so_number||null,order_id:a.order_id})),K=l.map(a=>({id:a.id,source:"part",issue_type:a.issue_type,description:a.description,reported_by:a.reported_by,status:a.status,created_at:a.created_at,resolved_at:a.resolved_at,resolved_by:a.resolved_by,resolution_notes:a.resolution_notes,part_number:a.part_number,so_number:null,order_id:null})),S=[...J,...K];S.sort((a,Q)=>new Date(Q.created_at).getTime()-new Date(a.created_at).getTime()),this.unifiedIssues=S}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}get filteredIssues(){return this.statusFilter==="all"?this.unifiedIssues:this.unifiedIssues.filter(e=>e.status===this.statusFilter)}get openIssuesCount(){return this.unifiedIssues.filter(e=>e.status==="open").length}get resolvedIssuesCount(){return this.unifiedIssues.filter(e=>e.status==="resolved").length}handleResolveIssue(e){this.resolveTarget=e,this.resolutionNotes="",this.showResolveModal=!0}confirmResolveIssue(){return C(this,null,function*(){if(!this.resolveTarget)return;let e=this.settingsService.getUserName(),l=this.resolutionNotes.trim()||void 0;this.resolveTarget.source==="order"?yield this.issuesService.resolveIssue(this.resolveTarget.id,e,l):yield this.partIssuesService.resolveIssue(this.resolveTarget.id,e,l),this.showResolveModal=!1,this.resolveTarget=null,this.resolutionNotes=""})}handleReopenIssue(e){return C(this,null,function*(){e.source==="order"?yield this.issuesService.reopenIssue(e.id):yield this.partIssuesService.reopenIssue(e.id)})}static{this.\u0275fac=function(l){return new(l||t)(g(G),g(H),g(z),g(q))}}static{this.\u0275cmp=E({type:t,selectors:[["app-issues"]],standalone:!0,features:[N],decls:49,vars:25,consts:[[1,"page-header","d-flex","flex-wrap","justify-content-between","align-items-center","gap-3"],[1,"page-title"],[1,"page-subtitle"],[1,"row","g-3","mb-4"],[1,"col-6","col-lg-3"],[1,"card","stat-card","border-danger"],[1,"card-body"],[1,"stat-label"],[1,"stat-value","text-danger"],[1,"card","stat-card","border-success"],[1,"stat-value","text-success"],[1,"card","filter-bar"],[1,"d-flex","flex-wrap","gap-2"],[1,"btn","btn-sm",3,"click"],["class","card",4,"ngIf"],["class","d-flex flex-column gap-3",4,"ngIf"],["tabindex","-1",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-success",3,"click"],[1,"bi","bi-check-lg","me-1"],["class","modal-backdrop fade show",4,"ngIf"],[1,"card"],[1,"card-body","text-center","py-5","text-muted"],[1,"card-body","text-center","py-5"],[1,"bi","bi-check-circle","display-4","text-success","mb-3"],[1,"text-muted","mb-0"],[1,"d-flex","flex-column","gap-3"],["class","card",3,"border-danger","border-success","opacity-75",4,"ngFor","ngForOf"],[1,"d-flex","flex-wrap","justify-content-between","align-items-start","gap-3"],[1,"flex-grow-1"],[1,"d-flex","align-items-center","gap-2","mb-2"],[1,"badge",3,"ngClass"],["class","text-decoration-none small",3,"routerLink",4,"ngIf"],["class","fw-medium mb-1",4,"ngIf"],["class","text-muted mb-2",4,"ngIf"],[1,"small","text-muted"],[4,"ngIf"],["class","btn btn-sm btn-success",3,"click",4,"ngIf"],["class","btn btn-sm btn-outline-warning",3,"click",4,"ngIf"],[1,"text-decoration-none","small",3,"routerLink"],[1,"fw-medium","mb-1"],[1,"text-muted","mb-2"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"btn","btn-sm","btn-outline-warning",3,"click"],[1,"bi","bi-arrow-counterclockwise","me-1"],[1,"modal-body"],[1,"mb-3"],["class","mb-3",4,"ngIf"],["for","resolutionNotes",1,"form-label"],["id","resolutionNotes","rows","3","placeholder","Enter explanation (optional)",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-muted"],[1,"modal-backdrop","fade","show"]],template:function(l,o){l&1&&(n(0,"div")(1,"div",0)(2,"div")(3,"h1",1),r(4,"Issues"),i(),n(5,"p",2),r(6,"Track and resolve picking issues"),i()()(),n(7,"div",3)(8,"div",4)(9,"div",5)(10,"div",6)(11,"div",7),r(12,"Open Issues"),i(),n(13,"div",8),r(14),i()()()(),n(15,"div",4)(16,"div",9)(17,"div",6)(18,"div",7),r(19,"Resolved"),i(),n(20,"div",10),r(21),i()()()()(),n(22,"div",11)(23,"div",6)(24,"div",12)(25,"button",13),v("click",function(){return o.statusFilter="all"}),r(26,"All"),i(),n(27,"button",13),v("click",function(){return o.statusFilter="open"}),r(28),i(),n(29,"button",13),v("click",function(){return o.statusFilter="resolved"}),r(30),i()()()(),_(31,Y,3,0,"div",14)(32,Z,5,1,"div",14)(33,le,2,1,"div",15),n(34,"div",16)(35,"div",17)(36,"div",18)(37,"div",19)(38,"h5",20),r(39,"Resolve Issue"),i(),n(40,"button",21),v("click",function(){return o.showResolveModal=!1}),i()(),_(41,ue,18,4,"div",22),n(42,"div",23)(43,"button",24),v("click",function(){return o.showResolveModal=!1}),r(44,"Cancel"),i(),n(45,"button",25),v("click",function(){return o.confirmResolveIssue()}),b(46,"i",26),r(47," Resolve Issue "),i()()()()(),_(48,ce,1,0,"div",27),i()),l&2&&(s(14),y(o.openIssuesCount),s(7),y(o.resolvedIssuesCount),s(4),f("btn-primary",o.statusFilter==="all")("btn-outline-secondary",o.statusFilter!=="all"),s(2),f("btn-danger",o.statusFilter==="open")("btn-outline-danger",o.statusFilter!=="open"),s(),m(" Open (",o.openIssuesCount,") "),s(),f("btn-success",o.statusFilter==="resolved")("btn-outline-success",o.statusFilter!=="resolved"),s(),m(" Resolved (",o.resolvedIssuesCount,") "),s(),d("ngIf",o.loading),s(),d("ngIf",!o.loading&&o.filteredIssues.length===0),s(),d("ngIf",!o.loading&&o.filteredIssues.length>0),s(),T("display",o.showResolveModal?"block":"none"),f("show",o.showResolveModal),s(7),d("ngIf",o.resolveTarget),s(7),d("ngIf",o.showResolveModal))},dependencies:[D,P,V,$,j,L,B,A,U,W],encapsulation:2})}}return t})();export{Se as IssuesComponent};
